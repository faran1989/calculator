<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø´Øªâ€ŒÛŒØ§Ø¨ Ù…Ø§Ù„ÛŒ â€” Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap');
:root{
  --bg:#f5f3ef;--s1:#ffffff;--s2:#faf9f7;--s3:#f0eeea;
  --border:#e2dfd8;--border2:#ece9e3;
  --accent:#b8860b;--accent-l:rgba(184,134,11,.08);--accent-ll:rgba(184,134,11,.03);
  --red:#c0392b;--red-l:rgba(192,57,43,.07);
  --orange:#d35400;--orange-l:rgba(211,84,0,.07);
  --green:#1a8a5c;--green-l:rgba(26,138,92,.07);
  --blue:#2c3e50;--muted:#7c7770;--muted2:#9a948b;
  --shadow: 0 18px 50px rgba(20,18,15,.08);
  --shadow2: 0 10px 25px rgba(20,18,15,.08);
  --radius: 18px;
  --radius2: 14px;
  --max: 1080px;
  --grad: radial-gradient(1200px 500px at 80% -10%, rgba(184,134,11,.10), transparent 60%),
          radial-gradient(900px 420px at 10% 0%, rgba(26,138,92,.08), transparent 60%),
          radial-gradient(900px 420px at 95% 60%, rgba(192,57,43,.05), transparent 60%);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background: var(--bg);
  color:#1f1d1a;
}
body::before{
  content:"";
  position:fixed;inset:0;
  background:var(--grad);
  pointer-events:none;
}
a{color:inherit}
.wrap{
  max-width:var(--max);
  margin:0 auto;
  padding:28px 18px 80px;
}
.header{
  display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
  padding:20px 22px;
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  position:relative;
  overflow:hidden;
}
.header::after{
  content:"";
  position:absolute;inset:-1px;
  background:linear-gradient(120deg, rgba(184,134,11,.12), transparent 35%, rgba(26,138,92,.10));
  opacity:.35;pointer-events:none;
}
.h-left{position:relative;z-index:2}
.h-title{
  font-size:20px;font-weight:900;letter-spacing:-.5px;
}
.h-sub{
  margin-top:6px;
  font-size:12px;
  color:var(--muted);
  line-height:1.9;
}
.h-right{display:flex;flex-direction:column;gap:8px;align-items:flex-end;position:relative;z-index:2}
.badge{
  font-size:11px;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--s2);
  display:inline-flex;gap:6px;align-items:center;
  color:var(--muted);
}
.badge b{color:var(--blue)}
.small-note{
  font-size:10px;color:var(--muted2);line-height:1.6;text-align:left;
  max-width:220px;
}
.steps{
  display:flex;gap:10px;
  margin-top:16px;
}
.step{
  flex:1;
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px 14px;
  display:flex;align-items:center;gap:10px;
  box-shadow:var(--shadow2);
  position:relative;
  overflow:hidden;
}
.step::after{
  content:"";
  position:absolute;inset:-1px;
  background:linear-gradient(120deg, rgba(184,134,11,.12), transparent 50%);
  opacity:.22;pointer-events:none;
}
.step .num{
  width:32px;height:32px;border-radius:10px;
  display:grid;place-items:center;
  background:var(--s3);
  border:1px solid var(--border2);
  font-weight:900;
  color:var(--muted);
}
.step.on .num{background:var(--accent-l);border-color:rgba(184,134,11,.18);color:var(--accent)}
.step.done .num{background:var(--green-l);border-color:rgba(26,138,92,.18);color:var(--green)}
.step .lbl{font-size:12px;font-weight:800}
.step .desc{font-size:10px;color:var(--muted);margin-top:2px;line-height:1.6}
.step .txt{display:flex;flex-direction:column}
.mode-switch{
  margin-top:16px;
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:var(--radius2);
  padding:14px 16px;
  box-shadow:var(--shadow2);
  display:flex;align-items:center;justify-content:space-between;gap:14px;
}
.mode-left{display:flex;flex-direction:column;gap:3px}
.mode-title{font-size:12px;font-weight:900}
.mode-desc{font-size:10px;color:var(--muted);line-height:1.6}
.toggle{
  display:flex;align-items:center;gap:10px;
}
.toggle span{font-size:11px;color:var(--muted);font-weight:800}
.switch{
  width:52px;height:30px;border-radius:999px;
  border:1px solid var(--border);
  background:var(--s3);
  position:relative;cursor:pointer;transition:all .25s ease;
}
.knob{
  width:24px;height:24px;border-radius:999px;
  background:var(--s1);
  border:1px solid var(--border2);
  position:absolute;top:50%;transform:translateY(-50%);
  left:3px;
  box-shadow:0 6px 15px rgba(0,0,0,.08);
  transition:all .25s ease;
}
.switch.on{
  background:var(--accent-l);
  border-color:rgba(184,134,11,.22);
}
.switch.on .knob{left:25px;border-color:rgba(184,134,11,.25)}
.form{
  margin-top:16px;
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:14px;
  align-items:start;
}
.card{
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px 18px 16px;
}
.card-title{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
}
.card-title h2{
  margin:0;
  font-size:14px;
  letter-spacing:-.2px;
}
.card-title .hint{
  font-size:10px;
  color:var(--muted);
  background:var(--s2);
  border:1px solid var(--border2);
  padding:7px 10px;border-radius:999px;
}
.field{
  margin-top:14px;
  display:flex;flex-direction:column;gap:6px;
}
label{
  font-size:11px;
  color:var(--muted);
  font-weight:800;
}
.fi-wrap{
  position:relative;
}
.fi{
  width:100%;
  height:46px;
  border-radius:14px;
  border:1.5px solid var(--border);
  background:var(--s2);
  padding:0 14px;
  font-size:14px;
  font-weight:900;
  letter-spacing:-.3px;
  outline:none;
  transition:all .2s ease;
}
.fi:focus{
  border-color:rgba(184,134,11,.5);
  box-shadow:0 0 0 4px rgba(184,134,11,.07);
  background:#fff;
}
.fi-sfx{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:11px;
  color:var(--muted2);
  font-weight:800;
  pointer-events:none;
}
.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.acc{
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:16px;
  overflow:hidden;
  background:var(--s1);
  box-shadow:var(--shadow2);
  transition:all .25s ease;
  animation: fUp .4s ease both;
}
.acc.lit{
  border-color:rgba(184,134,11,.25);
  box-shadow:0 16px 45px rgba(184,134,11,.08);
}
.acc-hd{
  padding:14px 14px;
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  cursor:pointer;
  background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.01));
}
.acc-ico{
  width:34px;height:34px;border-radius:12px;
  display:grid;place-items:center;
  background:var(--s3);
  border:1px solid var(--border2);
  font-size:16px;
  flex-shrink:0;
}
.acc-inf{display:flex;flex-direction:column;gap:2px;min-width:0}
.acc-ttl{font-size:13px;font-weight:900}
.acc-tot{font-size:11px;color:var(--muted);font-weight:800}
.acc-r{display:flex;align-items:center;gap:8px}
.acc-badge{
  display:none;
  font-size:10px;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  background:var(--s3);
  border:1px solid var(--border2);
  color:var(--muted);
}
.acc-arr{font-size:14px;color:var(--muted);transition:transform .25s ease}
.acc.open .acc-arr{transform:rotate(180deg)}
.acc-prog{
  height:6px;
  background:var(--s3);
  border-top:1px solid var(--border2);
}
.acc-prog-fill{
  height:100%;
  width:0%;
  background:var(--green);
  transition:width .35s ease;
}
.acc-body{
  padding:12px 14px 16px;
  border-top:1px solid var(--border2);
  display:none;
}
.acc.open .acc-body{display:block}
.sub-note{
  font-size:11px;
  color:var(--muted);
  line-height:1.9;
  margin:0 0 10px;
}
.sub-grp-ttl{
  margin:12px 0 8px;
  font-size:11px;
  font-weight:900;
  color:var(--blue);
  display:flex;align-items:center;gap:8px;
}
.sub-grp-ttl::before{
  content:"";
  width:10px;height:10px;border-radius:3px;
  background:var(--accent-l);
  border:1px solid rgba(184,134,11,.2);
}
.sub{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 0;
  border-bottom:1px dashed var(--border2);
}
.sub:last-child{border-bottom:none}
.sub-lbl{font-size:12px;font-weight:800;color:var(--blue)}
.fi.sm{height:42px;border-radius:12px;font-size:13px}
.btn{
  margin-top:14px;
  width:100%;
  height:48px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--s3);
  font-family:'Vazirmatn',sans-serif;
  font-weight:900;
  font-size:13px;
  cursor:pointer;
  transition:all .2s ease;
}
.btn:disabled{opacity:.55;cursor:not-allowed}
.btn-primary{
  background:linear-gradient(135deg, rgba(184,134,11,.18), rgba(184,134,11,.08));
  border-color:rgba(184,134,11,.25);
}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 16px 35px rgba(184,134,11,.12)}
.sidebar{
  position:sticky;
  top:16px;
}
.side-box{
  margin-top:12px;
  border-radius:16px;
  border:1px solid var(--border);
  background:var(--s1);
  box-shadow:var(--shadow2);
  padding:14px;
}
.side-box h3{margin:0 0 8px;font-size:12px;font-weight:900}
.side-box p{margin:0;font-size:11px;color:var(--muted);line-height:1.9}
.live{
  display:flex;flex-direction:column;gap:10px;
}
.live-row{
  display:flex;align-items:center;justify-content:space-between;
  font-size:12px;
  border-bottom:1px solid var(--border2);
  padding:8px 0;
}
.live-row:last-child{border-bottom:none}
.live-row b{font-weight:900}
.live-row .v{font-weight:900}
.v.green{color:var(--green)}
.v.red{color:var(--red)}
.v.orange{color:var(--orange)}
.v.accent{color:var(--accent)}

.quick-mode .acc-body{display:none!important}
.quick-mode .acc{opacity:1}
.quick-mode .acc-hd{cursor:default}
.quick-mode .acc-arr{display:none}
.quick-mode .acc-prog{display:none}
.quick-mode .acc-badge{display:none!important}
.quick-mode .acc-quick{
  padding:12px 14px 16px;
  border-top:1px solid var(--border2);
  display:block;
}
.acc-quick{display:none}
.acc-quick .sub{border-bottom:none;padding:0;margin-top:6px}
.acc-quick .sub-lbl{font-size:11px;color:var(--muted)}
.acc-quick .fi.sm{height:44px}

.result{
  margin-top:16px;
  display:none;
}
.r-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  align-items:start;
}
.r-card{
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
}
.r-card h3{margin:0 0 10px;font-size:13px;font-weight:900}
.r-card .mini{font-size:11px;color:var(--muted);line-height:1.9;margin:0}

.mirror{
  margin-top:10px;
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:14px;
  padding:14px;
  font-size:12px;
  line-height:2;
  color:var(--blue);
}
.summary{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.sr{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;
  border-radius:12px;
  background:var(--s2);
  border:1px solid var(--border2);
  font-size:12px;
}
.sr-lbl{color:var(--muted);font-weight:800}
.sr-val{font-weight:900;color:var(--blue)}
.sr-val.green{color:var(--green)}
.sr-val.red{color:var(--red)}
.sr-total{background:linear-gradient(135deg, rgba(184,134,11,.08), rgba(26,138,92,.06));border-color:rgba(184,134,11,.16)}
.bars{margin-top:10px;display:flex;flex-direction:column;gap:10px}
.cbar{
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:16px;
  padding:12px;
}
.cbar-head{display:flex;align-items:center;justify-content:space-between;gap:10px}
.cbar-left{display:flex;align-items:center;gap:8px;min-width:0}
.cbar-name{font-size:12px;font-weight:900}
.cbar-amt{font-size:11px;color:var(--muted);font-weight:900}
.cbar-right{display:flex;align-items:center;gap:8px}
.ctag{
  font-size:10px;font-weight:900;
  padding:6px 10px;border-radius:999px;
  border:1px solid var(--border2);
  background:var(--s3);
  color:var(--muted);
}
.ctag.t-max{background:var(--red-l);border-color:rgba(192,57,43,.2);color:var(--red)}
.ctag.t-hi{background:var(--orange-l);border-color:rgba(211,84,0,.2);color:var(--orange)}
.ctag.t-mild{background:var(--accent-ll);border-color:rgba(184,134,11,.22);color:var(--accent)}
.ctag.t-ok{background:var(--green-l);border-color:rgba(26,138,92,.2);color:var(--green)}
.ctag.t-zero{background:rgba(124,119,112,.07);border-color:rgba(124,119,112,.2);color:var(--muted)}
.cbar-pct{font-weight:900;font-size:11px}
.cbar-track{
  position:relative;
  height:10px;
  background:rgba(0,0,0,.05);
  border-radius:999px;
  overflow:hidden;
  margin-top:10px;
}
.cbar-ideal-zone{
  position:absolute;top:0;bottom:0;
  background:rgba(26,138,92,.10);
}
.cbar-ideal-end{
  position:absolute;top:-4px;bottom:-4px;
  width:2px;background:rgba(26,138,92,.35);
}
.cbar-fill{
  position:absolute;top:0;bottom:0;right:0;
  width:0%;
  background:var(--green);
  border-radius:999px;
  transition:width .55s ease;
}
.leaks{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.leak-card{
  border-radius:18px;
  border:1px solid rgba(192,57,43,.18);
  background:linear-gradient(135deg, rgba(192,57,43,.06), rgba(184,134,11,.04));
  padding:16px;
}
.leak-card.secondary{
  border-color:rgba(211,84,0,.18);
  background:linear-gradient(135deg, rgba(211,84,0,.05), rgba(184,134,11,.03));
}
.leak-inner{display:flex;flex-direction:column;gap:8px}
.leak-cat{
  font-size:10px;letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);font-weight:800;
}
.leak-name{font-size:14px;font-weight:900;color:var(--blue)}
.leak-sub{font-size:11px;color:var(--muted);line-height:1.9}
.leak-stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:6px;
}
.ls{
  background:rgba(255,255,255,.55);
  border:1px solid rgba(226,223,216,.8);
  border-radius:14px;
  padding:10px;
}
.ls-l{font-size:10px;color:var(--muted);font-weight:800}
.ls-v{font-size:12px;font-weight:900;color:var(--blue);margin-top:4px}
.top-items{margin-top:8px}
.top-items-ttl{font-size:11px;font-weight:900;color:var(--blue);margin-bottom:6px}
.top-item{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:8px 10px;
  border-radius:12px;
  background:rgba(255,255,255,.6);
  border:1px solid rgba(226,223,216,.8);
  font-size:11px;
}
.top-item-name{color:var(--muted);font-weight:800}
.top-item-val{font-weight:900}
.top-item-pct{font-weight:900;color:var(--accent)}

.peer-card{margin-top:10px}
.peer-title{font-size:12px;font-weight:900;margin:0 0 10px}
.peer-row{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;
  border-radius:14px;
  background:var(--s2);
  border:1px solid var(--border2);
  margin-top:8px;
}
.peer-emoji{font-size:16px}
.peer-info{flex:1;min-width:0}
.peer-label{font-size:12px;font-weight:900}
.peer-desc{font-size:10px;color:var(--muted);line-height:1.7;margin-top:2px}
.peer-status{
  font-size:10px;font-weight:900;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(0,0,0,.05);
  white-space:nowrap;
}
.action-card{
  grid-column:1/-1;
  padding:0;
  overflow:hidden;
}
.action-head{
  padding:18px 18px 14px;
  border-bottom:1px solid var(--border2);
  background:linear-gradient(135deg, rgba(26,138,92,.06), rgba(184,134,11,.06));
}
.layer-tag{
  display:inline-flex;align-items:center;gap:8px;
  font-size:10px;font-weight:900;
  letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);
  margin-bottom:10px;
}
.layer-tag-num{
  width:26px;height:26px;border-radius:10px;
  display:grid;place-items:center;
  background:var(--s3);
  border:1px solid var(--border2);
  color:var(--muted);
}
.layer-tag-txt{font-weight:900}
.action-title{font-size:16px;font-weight:900;color:var(--blue);margin:0 0 8px}
.action-sub{font-size:11px;color:var(--muted);line-height:1.9;margin:0}
.action-body{padding:16px 18px 18px}
.a-steps{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:12px;
  margin-top:12px;
}
.a-step{
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:16px;
  padding:12px;
  position:relative;
  overflow:hidden;
}
.a-step::after{
  content:"";
  position:absolute;inset:-1px;
  background:linear-gradient(120deg, rgba(184,134,11,.10), transparent 45%);
  opacity:.22;pointer-events:none;
}
.a-step-line{
  position:absolute;right:0;top:0;bottom:0;width:4px;
  background:rgba(184,134,11,.25);
}
.a-step-left{display:flex;align-items:flex-start;justify-content:flex-end}
.a-num{
  width:30px;height:30px;border-radius:12px;
  display:grid;place-items:center;
  background:var(--s3);
  border:1px solid var(--border2);
  font-weight:900;color:var(--accent);
}
.a-content{margin-top:10px}
.a-ttl{font-size:12px;font-weight:900;margin:0 0 6px}
.a-body{font-size:11px;color:var(--muted);line-height:1.9;margin:0}
.a-box{
  margin-top:10px;
  background:rgba(26,138,92,.07);
  border:1px solid rgba(26,138,92,.18);
  border-radius:14px;
  padding:10px;
  font-size:11px;
  line-height:1.9;
  color:var(--blue);
}
.a-time{
  margin-top:10px;
  display:flex;align-items:center;gap:8px;
  font-size:10px;
  color:var(--muted);
  font-weight:900;
}
.a-time-dot{
  width:8px;height:8px;border-radius:999px;
  background:var(--accent);
  box-shadow:0 0 0 4px rgba(184,134,11,.12);
}
.action-savings{
  margin-top:10px;
  display:flex;align-items:center;justify-content:space-between;
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px 14px;
}
.as-l{font-size:11px;color:var(--muted);font-weight:800}
.as-v{font-size:14px;font-weight:900;color:var(--green)}
.as-s{font-size:10px;color:var(--muted2);font-weight:800}
.rules-card{grid-column:1/-1}
.rules-title{font-size:12px;font-weight:900;margin:0 0 10px}
.rule-item{
  display:flex;align-items:center;gap:10px;
  padding:12px 12px;
  border-radius:14px;
  background:var(--s2);
  border:1px solid var(--border2);
  margin-top:8px;
  font-size:12px;
  line-height:1.8;
  cursor:pointer;
  transition:all .2s ease;
}
.rule-item:hover{transform:translateY(-1px);border-color:rgba(184,134,11,.25)}
.rule-num{
  width:28px;height:28px;border-radius:12px;
  display:grid;place-items:center;
  background:var(--s3);
  border:1px solid var(--border2);
  font-weight:900;color:var(--muted);
  flex-shrink:0;
}
.whatif-card{grid-column:1/-1}
.whatif-title{font-size:12px;font-weight:900;margin:0 0 10px}
.whatif-row{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:14px;
  padding:12px 12px;
  margin-top:8px;
}
.whatif-label{font-size:12px;font-weight:900}
.whatif-slider-wrap{display:flex;align-items:center;gap:10px}
.whatif-slider{width:210px}
.whatif-val{font-size:10px;color:var(--muted);font-weight:900;min-width:120px;text-align:left}
.whatif-result{
  margin-top:12px;
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
}
.whatif-result-item{
  background:linear-gradient(135deg, rgba(26,138,92,.06), rgba(184,134,11,.05));
  border:1px solid rgba(184,134,11,.16);
  border-radius:16px;
  padding:12px;
}
.whatif-result-label{font-size:10px;color:var(--muted);font-weight:900}
.whatif-result-val{font-size:18px;font-weight:800;color:var(--blue)}

/* SHARE */
.share-bar{display:flex;gap:8px;margin-top:4px}
.share-btn{flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--s1);font-family:'Vazirmatn',sans-serif;font-size:11px;font-weight:900;cursor:pointer}
.share-btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(0,0,0,.06)}

.health-score-card{
  grid-column:1/-1;
  padding:20px 22px;
}
.hs-title{font-size:12px;font-weight:900;color:var(--blue)}
.hs-circle-wrap{display:flex;align-items:center;gap:16px;margin-top:12px}
.hs-num{display:flex;flex-direction:column;gap:3px}
.hs-num-val{font-size:44px;font-weight:900;line-height:1}
.hs-num-label{font-size:12px;color:var(--muted);font-weight:900}
.hs-desc{margin-top:10px;font-size:11px;color:var(--muted);line-height:1.9}
.hs-factors{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.hs-factor{
  font-size:10px;font-weight:900;
  padding:7px 10px;border-radius:999px;
  background:var(--s2);
  border:1px solid var(--border2);
  color:var(--muted);
  display:inline-flex;gap:8px;align-items:center;
}
.hs-factor-dot{width:8px;height:8px;border-radius:999px;background:var(--green)}
.hs-circle-bg{fill:none;stroke:rgba(0,0,0,.06);stroke-width:12}
.hs-circle-fill{fill:none;stroke-width:12;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%;transition:stroke-dashoffset 1.2s ease}
.hs-circle{width:160px;height:160px}

@media (max-width: 920px){
  .form{grid-template-columns:1fr}
  .sidebar{position:static}
  .r-grid{grid-template-columns:1fr}
  .a-steps{grid-template-columns:1fr}
  .whatif-result{grid-template-columns:1fr}
  .whatif-slider{width:160px}
}

/* ANNUAL */
.annual-row{display:grid;grid-template-columns:1fr 112px;gap:10px;align-items:center}
.annual-month{width:112px;height:42px;border-radius:11px;border:1.5px solid var(--border);background:var(--s3);font-family:'Vazirmatn',sans-serif;font-size:12px;font-weight:700;color:var(--text);padding:0 12px;outline:none}
.annual-month:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(184,134,11,.06)}

/* ACHIEVEMENT */
.ach-card{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:20px 22px;margin-bottom:10px;box-shadow:var(--shadow)}
.ach-title{font-size:11px;letter-spacing:3px;color:var(--muted);font-weight:700;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.ach-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px solid var(--border2);font-size:12px}
.ach-row:last-child{border-bottom:none}
.ach-val{font-weight:800;letter-spacing:-.2px}

/* RULE COPY */
.rule-main{flex:1;min-width:0}
.rule-copy{border:none;background:var(--s1);border:1px solid var(--border2);color:var(--muted);border-radius:9px;padding:8px 10px;font-family:'Vazirmatn',sans-serif;font-size:10px;font-weight:800;cursor:pointer;transition:all .2s;flex-shrink:0}
.rule-copy:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-ll)}
.rule-copied{border-color:rgba(26,138,92,.25)!important;color:var(--green)!important;background:var(--green-l)!important}

/* PRINT */
.print-only{display:none}
@media print{
  body{background:#fff}
  body::before{display:none}
  .wrap{max-width:none;padding:0}
  #form,.mode-switch,.steps,.share-bar,.btn,#analyzeBtn{display:none!important}
  #result{display:block!important}
  .r-card,.health-score-card,.peer-card,.leak-card,.action-card,.rules-card,.whatif-card,.ach-card{box-shadow:none!important}
  .print-only{display:block}
  .no-print{display:none!important}
}

@keyframes fUp{
  from{transform:translateY(6px);opacity:0}
  to{transform:translateY(0);opacity:1}
}
</style>
</head>
<body>
<div class="wrap">

  <div class="header">
    <div class="h-left">
      <div class="h-title">Ù†Ø´Øªâ€ŒÛŒØ§Ø¨ Ù…Ø§Ù„ÛŒ â€” Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div>
      <div class="h-sub">
        Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Â«ØªØ®Ù…ÛŒÙ†ÛŒÂ» Ø§Ø³Øª: Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø§Ù„Ú¯ÙˆÛŒ Ø®Ø±Ø¬â€ŒÚ©Ø±Ø¯Ù† Ø±ÙˆØ´Ù† Ø´ÙˆØ¯ØŒ Ù†Ù‡ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø§ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ú©Ù†Ø¯.
        Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ø§ Ø­Ø¯ÙˆØ¯ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯Ø› Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² Ø¯Ù‚ØªØŒ <b>Ø¢Ú¯Ø§Ù‡ÛŒ</b> Ø§Ø³Øª.
      </div>
    </div>
    <div class="h-right">
      <div class="badge">ğŸ¯ Ù‡Ø¯Ù: <b>Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ</b> Ù†Ø´Øªâ€ŒÙ‡Ø§</div>
      <div class="small-note">Ø³Ø§Ø¯Ù‡ Ø¨Ù…Ø§Ù†. Ø¨Ø§ Ú†Ù†Ø¯ Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†Ø› Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø´Ø¯ØŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step on" id="s1">
      <div class="num">1</div>
      <div class="txt">
        <div class="lbl">ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§</div>
        <div class="desc">Ø¯Ø±Ø¢Ù…Ø¯ + Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</div>
      </div>
    </div>
    <div class="step" id="s2">
      <div class="num">2</div>
      <div class="txt">
        <div class="lbl">ØªØ­Ù„ÛŒÙ„</div>
        <div class="desc">Ù†Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</div>
      </div>
    </div>
    <div class="step" id="s3">
      <div class="num">3</div>
      <div class="txt">
        <div class="lbl">Ø§Ù‚Ø¯Ø§Ù…</div>
        <div class="desc">Ù‚Ø§Ù†ÙˆÙ† + Ø³Ù†Ø§Ø±ÛŒÙˆ</div>
      </div>
    </div>
  </div>

  <div class="mode-switch">
    <div class="mode-left">
      <div class="mode-title">Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹ / Ø¯Ù‚ÛŒÙ‚</div>
      <div class="mode-desc">Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹ ÙÙ‚Ø· Û· Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯. Ø­Ø§Ù„Øª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ø± Ø¯Ø³ØªÙ‡ Ø§Ø³Øª.</div>
    </div>
    <div class="toggle">
      <span id="modeLbl">Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹</span>
      <div class="switch" id="modeSw" onclick="toggleMode()">
        <div class="knob"></div>
      </div>
      <span>Ø­Ø§Ù„Øª Ø¯Ù‚ÛŒÙ‚</span>
    </div>
  </div>

  <div class="form" id="form">
    <div>
      <div class="card">
        <div class="card-title">
          <h2>Û±) Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²</h2>
          <div class="hint">Ù…Ø§Ù‡Ø§Ù†Ù‡ (ØªÙˆÙ…Ø§Ù†)</div>
        </div>

        <div class="grid2">
          <div class="field">
            <label>Ø¯Ø±Ø¢Ù…Ø¯ Ø®Ø§Ù„Øµ Ù…Ø§Ù‡Ø§Ù†Ù‡</label>
            <div class="fi-wrap">
              <input class="fi" id="income" inputmode="numeric" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û³Û°,Û°Û°Û°,Û°Û°Û°" oninput="onIncome(this)">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>

          <div class="field">
            <label>Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ù…Ø§Ù‡Ø§Ù†Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
            <div class="fi-wrap">
              <input class="fi" id="saving" inputmode="numeric" placeholder="Û°" oninput="onField(this,'saving')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>

        <div class="sub-note" style="margin-top:10px">
          Ø§Ú¯Ø± Ø¯Ù‚ÛŒÙ‚ Ù†Ù…ÛŒâ€ŒØ¯Ø§Ù†ÛŒØ¯ØŒ Ø­Ø¯ÙˆØ¯ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ù‡Ø± Ø²Ù…Ø§Ù† Ø®ÙˆØ§Ø³ØªÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.
        </div>
      </div>

      <!-- ACCORDIONS -->
      <div class="acc" id="acc-housing" style="animation-delay:.05s">
        <div class="acc-hd" onclick="togAcc('housing')">
          <div class="acc-ico">ğŸ </div>
          <div class="acc-inf">
            <div class="acc-ttl">Ù…Ø³Ú©Ù†</div>
            <div class="acc-tot" id="tot-housing">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-housing"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-housing"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ù…Ø³Ú©Ù†</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_housing" inputmode="numeric" placeholder="Û°" oninput="onField(this,'housing')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø§Ú¯Ø± Ø§Ø¬Ø§Ø±Ù‡/Ù‚Ø³Ø· Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù‡Ù…ÛŒÙ†â€ŒØ¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ø§Ø¬Ø§Ø±Ù‡</div><div class="fi-wrap"><input class="fi sm" id="rent" inputmode="numeric" placeholder="Û°" oninput="onField(this,'housing')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ù‚Ø³Ø· ÙˆØ§Ù… Ù…Ø³Ú©Ù†</div><div class="fi-wrap"><input class="fi sm" id="mortgage" inputmode="numeric" placeholder="Û°" oninput="onField(this,'housing')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø´Ø§Ø±Ú˜ / ØªØ¹Ù…ÛŒØ±Ø§Øª</div><div class="fi-wrap"><input class="fi sm" id="charge" inputmode="numeric" placeholder="Û°" oninput="onField(this,'housing')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

      <div class="acc" id="acc-food" style="animation-delay:.10s">
        <div class="acc-hd" onclick="togAcc('food')">
          <div class="acc-ico">ğŸ½ï¸</div>
          <div class="acc-inf">
            <div class="acc-ttl">Ø®ÙˆØ±Ø§Ú©</div>
            <div class="acc-tot" id="tot-food">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-food"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-food"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ø®ÙˆØ±Ø§Ú©</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_food" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø§Ú¯Ø± Ø¨ÛŒØ±ÙˆÙ†â€ŒØ®ÙˆØ±ÛŒ Ø¨Ø§Ù„Ø§Ø³ØªØŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø§ÙˆÙ„ÛŒÙ† Ù†Ø´Øª Ø§Ø³Øª.</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ø®Ø±ÛŒØ¯ Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª</div><div class="fi-wrap"><input class="fi sm" id="grocery" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø±Ø³ØªÙˆØ±Ø§Ù†</div><div class="fi-wrap"><input class="fi sm" id="restaurant" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ú©Ø§ÙÙ‡</div><div class="fi-wrap"><input class="fi sm" id="cafe" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†</div><div class="fi-wrap"><input class="fi sm" id="delivery" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ù†Ø§Ù‡Ø§Ø± Ø¨ÛŒØ±ÙˆÙ†</div><div class="fi-wrap"><input class="fi sm" id="lunch_out" inputmode="numeric" placeholder="Û°" oninput="onField(this,'food')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

      <div class="acc" id="acc-transport" style="animation-delay:.15s">
        <div class="acc-hd" onclick="togAcc('transport')">
          <div class="acc-ico">ğŸš—</div>
          <div class="acc-inf">
            <div class="acc-ttl">Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„</div>
            <div class="acc-tot" id="tot-transport">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-transport"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-transport"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_transport" inputmode="numeric" placeholder="Û°" oninput="onField(this,'transport')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø¨Ø±Ø§ÛŒ ØªØ§Ú©Ø³ÛŒ Ùˆ Ø³ÙˆØ®Øª Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Ø¬Ø¯Ø§ Ø¯Ø§Ø±ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ø³ÙˆØ®Øª</div><div class="fi-wrap"><input class="fi sm" id="fuel" inputmode="numeric" placeholder="Û°" oninput="onField(this,'transport')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">ØªØ§Ú©Ø³ÛŒ/Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ</div><div class="fi-wrap"><input class="fi sm" id="taxi" inputmode="numeric" placeholder="Û°" oninput="onField(this,'transport')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„ Ø¹Ù…ÙˆÙ…ÛŒ</div><div class="fi-wrap"><input class="fi sm" id="public" inputmode="numeric" placeholder="Û°" oninput="onField(this,'transport')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

      <div class="acc" id="acc-lifestyle" style="animation-delay:.20s">
        <div class="acc-hd" onclick="togAcc('lifestyle')">
          <div class="acc-ico">âœ¨</div>
          <div class="acc-inf">
            <div class="acc-ttl">Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ</div>
            <div class="acc-tot" id="tot-lifestyle">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-lifestyle"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-lifestyle"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_lifestyle" inputmode="numeric" placeholder="Û°" oninput="onField(this,'lifestyle')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‡ÛŒØ¬Ø§Ù†ÛŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø§ÛŒÙ†Ø¬Ø§ Ù¾Ù†Ù‡Ø§Ù† Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ù¾ÙˆØ´Ø§Ú©</div><div class="fi-wrap"><input class="fi sm" id="clothing" inputmode="numeric" placeholder="Û°" oninput="onField(this,'lifestyle')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">ØªÙØ±ÛŒØ­/Ø³Ø±Ú¯Ø±Ù…ÛŒ</div><div class="fi-wrap"><input class="fi sm" id="entertain" inputmode="numeric" placeholder="Û°" oninput="onField(this,'lifestyle')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø±ÙˆØ²Ø§Ù†Ù‡</div><div class="fi-wrap"><input class="fi sm" id="small" inputmode="numeric" placeholder="Û°" oninput="onField(this,'lifestyle')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

      <div class="acc" id="acc-bills" style="animation-delay:.25s">
        <div class="acc-hd" onclick="togAcc('bills')">
          <div class="acc-ico">ğŸ§¾</div>
          <div class="acc-inf">
            <div class="acc-ttl">Ù‚Ø¨ÙˆØ¶ Ùˆ Ø®Ø¯Ù…Ø§Øª</div>
            <div class="acc-tot" id="tot-bills">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-bills"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-bills"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ù‚Ø¨ÙˆØ¶</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_bills" inputmode="numeric" placeholder="Û°" oninput="onField(this,'bills')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù†Ø´Øª Ø¨Ø²Ø±Ú¯ Ù†ÛŒØ³ØªØ› Ø§Ù…Ø§ Ø¬Ù…Ø¹â€ŒØ´Ø¯Ù†Ø´ Ù…Ù‡Ù… Ø§Ø³Øª.</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ø¢Ø¨/Ø¨Ø±Ù‚/Ú¯Ø§Ø²</div><div class="fi-wrap"><input class="fi sm" id="utilities" inputmode="numeric" placeholder="Û°" oninput="onField(this,'bills')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø§ÛŒÙ†ØªØ±Ù†Øª/Ù…ÙˆØ¨Ø§ÛŒÙ„</div><div class="fi-wrap"><input class="fi sm" id="internet" inputmode="numeric" placeholder="Û°" oninput="onField(this,'bills')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§</div><div class="fi-wrap"><input class="fi sm" id="subs" inputmode="numeric" placeholder="Û°" oninput="onField(this,'bills')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

      <div class="acc" id="acc-finance" style="animation-delay:.30s">
        <div class="acc-hd" onclick="togAcc('finance')">
          <div class="acc-ico">ğŸ’³</div>
          <div class="acc-inf">
            <div class="acc-ttl">Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§</div>
            <div class="acc-tot" id="tot-finance">â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
          </div>
          <div class="acc-r"><span class="acc-badge" id="badge-finance"></span><span class="acc-arr">â–¼</span></div>
        </div>
        <div class="acc-prog"><div class="acc-prog-fill" id="prog-finance"></div></div>
        <div class="acc-quick">
          <div class="sub">
            <div class="sub-lbl">Ø¹Ø¯Ø¯ Ú©Ù„ÛŒ Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§</div>
            <div class="fi-wrap">
              <input class="fi sm" id="q_finance" inputmode="numeric" placeholder="Û°" oninput="onField(this,'finance')">
              <span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span>
            </div>
          </div>
        </div>
        <div class="acc-body">
          <p class="sub-note">Ø§Ú¯Ø± Ø§Ù‚Ø³Ø§Ø·/Ø¨Ø¯Ù‡ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø³Ù‡Ù…Ø´ Ø±Ø§ Ø¬Ø¯Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.</p>
          <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>
          <div class="sub"><div class="sub-lbl">Ù‚Ø³Ø· ÙˆØ§Ù…</div><div class="fi-wrap"><input class="fi sm" id="loan" inputmode="numeric" placeholder="Û°" oninput="onField(this,'finance')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ú©Ø§Ø±Øª/Ø§Ù‚Ø³Ø§Ø·</div><div class="fi-wrap"><input class="fi sm" id="installment" inputmode="numeric" placeholder="Û°" oninput="onField(this,'finance')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
          <div class="sub"><div class="sub-lbl">Ø®Ø±ÛŒØ¯ Ø§Ù‚Ø³Ø§Ø·ÛŒ (BNPL)</div><div class="fi-wrap"><input class="fi sm" id="credit_inst" inputmode="numeric" placeholder="Û°" oninput="onField(this,'finance')"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div></div>
        </div>
      </div>

<div class="acc" id="acc-annual" style="animation-delay:.30s">
  <div class="acc-hd" onclick="togAcc('annual')">
    <div class="acc-ico" style="background:rgba(184,134,11,.06);border:1px solid rgba(184,134,11,.1)">ğŸ—“ï¸</div>
    <div class="acc-inf">
      <div class="acc-ttl">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø³Ø§Ù„Ø§Ù†Ù‡</div>
      <div class="acc-tot" id="tot-annual">â€” Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</div>
    </div>
    <div class="acc-r"><span class="acc-badge" id="badge-annual"></span><span class="acc-arr">â–¼</span></div>
  </div>
  <div class="acc-prog"><div class="acc-prog-fill" id="prog-annual"></div></div>
  <div class="acc-body">
    <div class="sub-note" style="margin-top:10px">
      Ø§ÛŒÙ†â€ŒÙ‡Ø§ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ù†ÛŒØ³ØªÙ†Ø¯ØŒ ÙˆÙ„ÛŒ Ø§Ú¯Ø± Ø§Ø² Ù‚Ø¨Ù„ Â«Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ø§Ù‡Ø§Ù†Ù‡Â» Ú©Ù†Ø§Ø± Ù†Ú¯Ø°Ø§Ø±ÛŒØ¯ØŒ ÛŒÚ©â€ŒØ¯ÙØ¹Ù‡ Ø¨Ù‡ Ø¨ÙˆØ¯Ø¬Ù‡ ÙØ´Ø§Ø± Ù…ÛŒâ€ŒØ¢ÙˆØ±Ù†Ø¯.
    </div>

    <div class="sub-grp-ttl">Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ÛŒØ¬</div>

    <div class="sub">
      <div class="sub-lbl">Ø¨ÛŒÙ…Ù‡ Ø´Ø®Øµ Ø«Ø§Ù„Ø« / Ø¨Ø¯Ù†Ù‡ <span style="font-size:10px;color:var(--muted2)">Ù…Ø§Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ</span></div>
      <div class="annual-row">
        <div class="fi-wrap"><input class="fi sm" id="annual_insurance" inputmode="numeric" placeholder="Ù…Ø¨Ù„Øº Ø³Ø§Ù„Ø§Ù†Ù‡" oninput="onAnnualField(this)"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div>
        <select class="annual-month" id="annual_m_insurance" onchange="onAnnualMonth()">
          <option value="">Ù…Ø§Ù‡</option><option>ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option><option>Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option><option>Ø®Ø±Ø¯Ø§Ø¯</option><option>ØªÛŒØ±</option><option>Ù…Ø±Ø¯Ø§Ø¯</option><option>Ø´Ù‡Ø±ÛŒÙˆØ±</option><option>Ù…Ù‡Ø±</option><option>Ø¢Ø¨Ø§Ù†</option><option>Ø¢Ø°Ø±</option><option>Ø¯ÛŒ</option><option>Ø¨Ù‡Ù…Ù†</option><option>Ø§Ø³ÙÙ†Ø¯</option>
        </select>
      </div>
    </div>

    <div class="sub">
      <div class="sub-lbl">Ø¹ÛŒØ¯ÛŒ / Ù¾Ø§Ø¯Ø§Ø´ / Ù‡Ø¯ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ØªÛŒ <span style="font-size:10px;color:var(--muted2)">Ù…Ø§Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ</span></div>
      <div class="annual-row">
        <div class="fi-wrap"><input class="fi sm" id="annual_bonus" inputmode="numeric" placeholder="Ù…Ø¨Ù„Øº Ø³Ø§Ù„Ø§Ù†Ù‡" oninput="onAnnualField(this)"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div>
        <select class="annual-month" id="annual_m_bonus" onchange="onAnnualMonth()">
          <option value="">Ù…Ø§Ù‡</option><option>ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option><option>Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option><option>Ø®Ø±Ø¯Ø§Ø¯</option><option>ØªÛŒØ±</option><option>Ù…Ø±Ø¯Ø§Ø¯</option><option>Ø´Ù‡Ø±ÛŒÙˆØ±</option><option>Ù…Ù‡Ø±</option><option>Ø¢Ø¨Ø§Ù†</option><option>Ø¢Ø°Ø±</option><option>Ø¯ÛŒ</option><option>Ø¨Ù‡Ù…Ù†</option><option>Ø§Ø³ÙÙ†Ø¯</option>
        </select>
      </div>
    </div>

    <div class="sub">
      <div class="sub-lbl">ØªØ¹Ù…ÛŒØ±Ø§Øª Ø¨Ø²Ø±Ú¯ (Ø®Ø§Ù†Ù‡/Ø®ÙˆØ¯Ø±Ùˆ) <span style="font-size:10px;color:var(--muted2)">Ù…Ø§Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ</span></div>
      <div class="annual-row">
        <div class="fi-wrap"><input class="fi sm" id="annual_repair" inputmode="numeric" placeholder="Ù…Ø¨Ù„Øº Ø³Ø§Ù„Ø§Ù†Ù‡" oninput="onAnnualField(this)"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div>
        <select class="annual-month" id="annual_m_repair" onchange="onAnnualMonth()">
          <option value="">Ù…Ø§Ù‡</option><option>ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option><option>Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option><option>Ø®Ø±Ø¯Ø§Ø¯</option><option>ØªÛŒØ±</option><option>Ù…Ø±Ø¯Ø§Ø¯</option><option>Ø´Ù‡Ø±ÛŒÙˆØ±</option><option>Ù…Ù‡Ø±</option><option>Ø¢Ø¨Ø§Ù†</option><option>Ø¢Ø°Ø±</option><option>Ø¯ÛŒ</option><option>Ø¨Ù‡Ù…Ù†</option><option>Ø§Ø³ÙÙ†Ø¯</option>
        </select>
      </div>
    </div>

    <div class="sub">
      <div class="sub-lbl">Ø´Ù‡Ø±ÛŒÙ‡ Ù…Ø¯Ø±Ø³Ù‡/Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ <span style="font-size:10px;color:var(--muted2)">Ù…Ø§Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ</span></div>
      <div class="annual-row">
        <div class="fi-wrap"><input class="fi sm" id="annual_tuition" inputmode="numeric" placeholder="Ù…Ø¨Ù„Øº Ø³Ø§Ù„Ø§Ù†Ù‡" oninput="onAnnualField(this)"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div>
        <select class="annual-month" id="annual_m_tuition" onchange="onAnnualMonth()">
          <option value="">Ù…Ø§Ù‡</option><option>ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option><option>Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option><option>Ø®Ø±Ø¯Ø§Ø¯</option><option>ØªÛŒØ±</option><option>Ù…Ø±Ø¯Ø§Ø¯</option><option>Ø´Ù‡Ø±ÛŒÙˆØ±</option><option>Ù…Ù‡Ø±</option><option>Ø¢Ø¨Ø§Ù†</option><option>Ø¢Ø°Ø±</option><option>Ø¯ÛŒ</option><option>Ø¨Ù‡Ù…Ù†</option><option>Ø§Ø³ÙÙ†Ø¯</option>
        </select>
      </div>
    </div>

    <div class="sub">
      <div class="sub-lbl">Ø³ÙØ± Ø³Ø§Ù„Ø§Ù†Ù‡ <span style="font-size:10px;color:var(--muted2)">Ù…Ø§Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ</span></div>
      <div class="annual-row">
        <div class="fi-wrap"><input class="fi sm" id="annual_travel" inputmode="numeric" placeholder="Ù…Ø¨Ù„Øº Ø³Ø§Ù„Ø§Ù†Ù‡" oninput="onAnnualField(this)"><span class="fi-sfx">ØªÙˆÙ…Ø§Ù†</span></div>
        <select class="annual-month" id="annual_m_travel" onchange="onAnnualMonth()">
          <option value="">Ù…Ø§Ù‡</option><option>ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option><option>Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option><option>Ø®Ø±Ø¯Ø§Ø¯</option><option>ØªÛŒØ±</option><option>Ù…Ø±Ø¯Ø§Ø¯</option><option>Ø´Ù‡Ø±ÛŒÙˆØ±</option><option>Ù…Ù‡Ø±</option><option>Ø¢Ø¨Ø§Ù†</option><option>Ø¢Ø°Ø±</option><option>Ø¯ÛŒ</option><option>Ø¨Ù‡Ù…Ù†</option><option>Ø§Ø³ÙÙ†Ø¯</option>
        </select>
      </div>
    </div>
  </div>
</div>

      <button class="btn btn-primary" id="analyzeBtn" onclick="doAnalyze()" disabled>ØªØ­Ù„ÛŒÙ„ Ú©Ù† â†</button>
    </div>

    <div class="sidebar">
      <div class="card">
        <div class="card-title">
          <h2>Ù†Ù…Ø§ÛŒ Ø²Ù†Ø¯Ù‡</h2>
          <div class="hint" id="incomeLevel">â€”</div>
        </div>
        <div class="live" id="liveBox" style="margin-top:12px"></div>
      </div>

      <div class="side-box">
        <h3>Ú†Ø·ÙˆØ± Ø¨Ù‡ØªØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù…ØŸ</h3>
        <p>
          Û±) Ø¨Ø§ Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹ Ø´Ø±ÙˆØ¹ Ú©Ù†. <br>
          Û²) Ø§Ú¯Ø± ÛŒÚ© Ø¯Ø³ØªÙ‡ Ø®ÛŒÙ„ÛŒ Ø¨Ø§Ù„Ø§ Ø¨ÙˆØ¯ØŒ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø¨Ø§Ø² Ú©Ù† Ùˆ Ø¬Ø²Ø¦ÛŒØ§ØªØ´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†. <br>
          Û³) Ø¯Ø± Ù¾Ø§ÛŒØ§Ù†ØŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ú©ÙˆÚ†Ú© Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† Ùˆ ÛŒÚ© Ù…Ø§Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†.
        </p>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div class="result" id="result">
  <div class="ach-card" id="r-ach" style="display:none"></div>
  <div class="health-score-card r-card">
      <div id="r-health"></div>
    </div>

    <div class="r-grid">
      <div class="r-card">
        <h3>ğŸª Ø¢ÛŒÙ†Ù‡ Ù…Ø§Ù„ÛŒ</h3>
        <p class="mini">ÛŒÚ© ØªØµÙˆÛŒØ± Ø³Ø§Ø¯Ù‡ Ø§Ø² ØªØ±Ø§Ø² Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø´Ù…Ø§.</p>
        <div class="mirror" id="r-mirror"></div>

        <div class="summary" id="r-summ"></div>
      </div>

      <div class="r-card">
        <h3>ğŸ“Š Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§</h3>
        <p class="mini">Ø¯Ø±ØµØ¯ Ù‡Ø± Ø¯Ø³ØªÙ‡ Ø§Ø² Ø¯Ø±Ø¢Ù…Ø¯ (ØªÙ‚Ø±ÛŒØ¨ÛŒ).</p>
        <div class="bars" id="r-bars"></div>
      </div>

      <div class="r-card peer-card">
        <div id="r-peer"></div>
      </div>

      <div class="r-card">
        <h3>ğŸš¨ Ù†Ø´Øªâ€ŒÙ‡Ø§</h3>
        <p class="mini">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø³Ù‡Ù…Ø´Ø§Ù† Ø§Ø² Â«Ù†Ø±Ù…Ø§Ù„Â» Ø¨ÛŒØ´ØªØ± Ø§Ø³Øª.</p>
        <div class="leaks" id="r-leaks"></div>
      </div>

      <div class="r-card action-card">
        <div class="action-head">
          <div class="layer-tag" id="r-act-tag"><div class="layer-tag-num">3</div><span class="layer-tag-txt">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¹Ù…Ù„ÛŒ</span></div>
          <h3 class="action-title" id="r-act-title"></h3>
          <p class="action-sub">Ø³Ù‡ Ú¯Ø§Ù… Ø³Ø§Ø¯Ù‡ Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù…Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡.</p>
          <div class="action-savings" id="r-act-savings"></div>
        </div>
        <div class="action-body">
          <div class="a-steps" id="r-act-steps"></div>
        </div>
      </div>

      <div class="r-card rules-card" id="r-rules"></div>

      <div class="r-card whatif-card" id="r-whatif"></div>

      <div class="share-bar no-print">
<button class="share-btn" onclick="copyReport()">ğŸ“‹ Ú©Ù¾ÛŒ Ú¯Ø²Ø§Ø±Ø´</button><button class="share-btn" onclick="copyShareText()">ğŸŸ© Ø§Ø´ØªØ±Ø§Ú© Ù…ØªÙ†ÛŒ</button><button class="share-btn" onclick="doPrint()">ğŸ–¨ï¸ Ø®Ø±ÙˆØ¬ÛŒ PDF</button><button class="share-btn" onclick="doReset()">â†º Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button></div><div class="print-only" id="printable"></div>
    </div>
  </div>

</div>

<script>
/* ---------------------------
   Expense Leak Analyzer v2
   Vanilla HTML/CSS/JS
   --------------------------- */

const CATS=['housing','food','transport','lifestyle','bills','finance'];
const ALL_CATS=['saving',...CATS];

const FIELD_CAT={
  rent:'housing',mortgage:'housing',charge:'housing',
  grocery:'food',restaurant:'food',cafe:'food',delivery:'food',lunch_out:'food',
  fuel:'transport',taxi:'transport',public:'transport',
  clothing:'lifestyle',entertain:'lifestyle',small:'lifestyle',
  utilities:'bills',internet:'bills',subs:'bills',
  loan:'finance',installment:'finance',credit_inst:'finance',
}

const FIELD_LABEL={
  rent:'Ø§Ø¬Ø§Ø±Ù‡',mortgage:'Ù‚Ø³Ø· ÙˆØ§Ù… Ù…Ø³Ú©Ù†',charge:'Ø´Ø§Ø±Ú˜/ØªØ¹Ù…ÛŒØ±Ø§Øª',
  grocery:'Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª',restaurant:'Ø±Ø³ØªÙˆØ±Ø§Ù†',cafe:'Ú©Ø§ÙÙ‡',delivery:'Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†',lunch_out:'Ù†Ø§Ù‡Ø§Ø± Ø¨ÛŒØ±ÙˆÙ†',
  fuel:'Ø³ÙˆØ®Øª',taxi:'ØªØ§Ú©Ø³ÛŒ/Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ',public:'Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„ Ø¹Ù…ÙˆÙ…ÛŒ',
  clothing:'Ù¾ÙˆØ´Ø§Ú©',entertain:'ØªÙØ±ÛŒØ­/Ø³Ø±Ú¯Ø±Ù…ÛŒ',small:'Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ú©ÙˆÚ†Ú©',
  utilities:'Ù‚Ø¨ÙˆØ¶ Ø¢Ø¨/Ø¨Ø±Ù‚/Ú¯Ø§Ø²',internet:'Ø§ÛŒÙ†ØªØ±Ù†Øª/Ù…ÙˆØ¨Ø§ÛŒÙ„',subs:'Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§',
  loan:'Ù‚Ø³Ø· ÙˆØ§Ù…',installment:'Ø§Ù‚Ø³Ø§Ø·/Ú©Ø§Ø±Øª',credit_inst:'BNPL',
}

let currentMode='quick';

function fc(n){ // format number with commas
  return (n||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
function ft(n){
  const abs=Math.round(Math.abs(n||0));
  const m = abs>=1e6 ? (abs/1e6).toFixed(abs%1e6===0?0:1)+' Ù…ÛŒÙ„ÛŒÙˆÙ†' : fc(abs);
  return (n<0?'-':'')+m;
}
function pn(v){ // parse numeric
  if(!v) return 0;
  return parseInt((v+'').replace(/[^\d]/g,''))||0;
}

function getInc(){return pn(document.getElementById('income').value)}
function getAllFields(){
  const out={};
  Object.keys(FIELD_CAT).forEach(id=>{
    const el=document.getElementById(id);
    if(!el) return;
    const v=pn(el.value);
    if(v>0) out[id]=v;
  });
  return out;
}
function getCatVal(cat){
  // If quick mode, take q_xxx, otherwise sum details
  if(cat==='saving'){
    return pn(document.getElementById('saving').value);
  }
  if(currentMode==='quick'){
    const q=document.getElementById('q_'+cat);
    if(q) return pn(q.value);
  }
  // detailed: sum all fields in cat
  const all=getAllFields();
  let s=0;
  Object.keys(all).forEach(id=>{
    if(FIELD_CAT[id]===cat) s+=all[id];
  });
  // if user used quick too, let it act as override when detailed is empty
  const q=document.getElementById('q_'+cat);
  const qv=q?pn(q.value):0;
  if(s===0 && qv>0) s=qv;
  return s;
}

function getBM(income){
  // Benchmarks â€” simple heuristics, not strict rules.
  // ideal: [min,max] percentage range (for costs) except saving (reversed)
  // warn: [soft, hard]
  const low = income<15000000;
  const mid = income>=15000000 && income<40000000;
  const hi  = income>=40000000;

  return{
    saving:{label:'Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²',emoji:'ğŸ’°',ideal:[10,20],warn:[5,3]},
    housing:{label:'Ù…Ø³Ú©Ù†',emoji:'ğŸ ',ideal: hi?[18,28]:mid?[22,33]:[28,42],warn: hi?[35,42]:mid?[40,48]:[50,60]},
    food:{label:'Ø®ÙˆØ±Ø§Ú©',emoji:'ğŸ½ï¸',ideal: hi?[12,18]:mid?[16,25]:[22,32],warn: hi?[22,26]:mid?[28,34]:[36,45]},
    transport:{label:'Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„',emoji:'ğŸš—',ideal:[8,14],warn:[18,24]},
    lifestyle:{label:'Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ',emoji:'âœ¨',ideal: hi?[14,20]:mid?[10,16]:[8,12],warn: hi?[24,30]:mid?[20,26]:[18,24]},
    bills:{label:'Ù‚Ø¨ÙˆØ¶',emoji:'ğŸ§¾',ideal:[5,9],warn:[12,16]},
    finance:{label:'Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§',emoji:'ğŸ’³',ideal:[0,15],warn:[20,28]},
  }
}

// Annual (non-monthly big expenses)
const ANNUAL_ITEMS=[
  {id:'annual_insurance',mid:'annual_m_insurance',label:'Ø¨ÛŒÙ…Ù‡',defaultMonth:'Ø§Ø³ÙÙ†Ø¯'},
  {id:'annual_bonus',mid:'annual_m_bonus',label:'Ø¹ÛŒØ¯ÛŒ/Ù¾Ø§Ø¯Ø§Ø´',defaultMonth:'Ø§Ø³ÙÙ†Ø¯'},
  {id:'annual_repair',mid:'annual_m_repair',label:'ØªØ¹Ù…ÛŒØ±Ø§Øª Ø¨Ø²Ø±Ú¯',defaultMonth:'Ù…Ù‡Ø±'},
  {id:'annual_tuition',mid:'annual_m_tuition',label:'Ø´Ù‡Ø±ÛŒÙ‡/Ú©Ù„Ø§Ø³',defaultMonth:'Ù…Ù‡Ø±'},
  {id:'annual_travel',mid:'annual_m_travel',label:'Ø³ÙØ± Ø³Ø§Ù„Ø§Ù†Ù‡',defaultMonth:'Ø´Ù‡Ø±ÛŒÙˆØ±'},
];
function getAnnualData(){
  const items=ANNUAL_ITEMS.map(it=>{
    const amount=pn(document.getElementById(it.id)?.value);
    const month=(document.getElementById(it.mid)?.value)||'';
    return{...it,amount,month};
  }).filter(x=>x.amount>0);
  const total=items.reduce((s,x)=>s+x.amount,0);
  const monthly=Math.round(total/12);
  const peaks={};
  items.forEach(x=>{
    const m=x.month||x.defaultMonth||'';
    if(!m) return;
    peaks[m]=(peaks[m]||0)+x.amount;
  });
  return{items,total,monthly,peaks}
}
function onAnnualField(el){
  const raw=el.value.replace(/,/g,'');if(!/^\d*$/.test(raw)){el.value=el.value.slice(0,-1);return}
  const n=parseInt(raw)||0;const pos=el.selectionStart,old=el.value.length;el.value=n?fc(n):'';const d=el.value.length-old;try{el.setSelectionRange(pos+d,pos+d)}catch(e){}
  updAnnualUi();updLive();checkReady();
}
function onAnnualMonth(){updAnnualUi()}
function updAnnualUi(){
  const a=getAnnualData();
  const el=document.getElementById('tot-annual');
  if(el) el.textContent=a.total? (ft(a.total)+' Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡') : 'â€” Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡';
  const acc=document.getElementById('acc-annual');
  if(acc) acc.classList.toggle('lit',a.total>0);
  // badge/progress (Ù†Ù…Ø§ÛŒØ´ ØªÙ‚Ø±ÛŒØ¨ÛŒ: Ø³Ù‡Ù… Ø§Ø² Ø¯Ø±Ø¢Ù…Ø¯ Ø³Ø§Ù„Ø§Ù†Ù‡ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Û±Û²)
  const inc=getInc();
  const b=document.getElementById('badge-annual');
  const pf=document.getElementById('prog-annual');
  if(!inc || !a.monthly){
    if(b) b.style.display='none';
    if(pf){pf.style.width='0';pf.style.background='var(--green)'}
    return;
  }
  const p=Math.round((a.monthly/inc)*100);
  if(b){b.style.display='inline-flex';b.textContent=p+'Ùª';b.style.color='var(--accent)';b.style.background='var(--s3)'}
  if(pf){pf.style.width=Math.min(p,100)+'%';pf.style.background='var(--accent)'}
}

function toggleMode(){
  currentMode = currentMode==='quick' ? 'detailed' : 'quick';
  setMode(currentMode);
}
function setMode(mode){
  currentMode=mode;
  const form=document.getElementById('form');
  const sw=document.getElementById('modeSw');
  const lbl=document.getElementById('modeLbl');
  if(mode==='quick'){
    form.classList.add('quick-mode');
    sw.classList.remove('on');
    lbl.textContent='Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹';
    // close accordions
    CATS.forEach(c=>document.getElementById('acc-'+c)?.classList.remove('open'));
  }else{
    form.classList.remove('quick-mode');
    sw.classList.add('on');
    lbl.textContent='Ø­Ø§Ù„Øª Ø¯Ù‚ÛŒÙ‚';
    // open accordions for better visibility
    CATS.forEach(c=>document.getElementById('acc-'+c)?.classList.add('open'));
  }
  // update totals/progress/badges
  ALL_CATS.forEach(c=>{updSectionTot(c);updProg(c);updBadge(c)});updAnnualUi();updLive();checkReady()
}
function togAcc(cat){
  if(currentMode==='quick') return;
  const el=document.getElementById('acc-'+cat);
  if(!el) return;
  el.classList.toggle('open');
}

function onIncome(el){
  // numeric format
  const raw=el.value.replace(/,/g,'');
  if(!/^\d*$/.test(raw)){el.value=el.value.slice(0,-1);return}
  const n=parseInt(raw)||0;
  const pos=el.selectionStart,old=el.value.length;
  el.value=n?fc(n):'';
  const d=el.value.length-old;
  try{el.setSelectionRange(pos+d,pos+d)}catch(e){}
  setIncomeLevel();
  ALL_CATS.forEach(c=>{updProg(c);updBadge(c)});updAnnualUi();updLive();checkReady();
}

function onField(el,cat){
  // format
  const raw=el.value.replace(/,/g,'');
  if(!/^\d*$/.test(raw)){el.value=el.value.slice(0,-1);return}
  const n=parseInt(raw)||0;
  const pos=el.selectionStart,old=el.value.length;
  el.value=n?fc(n):'';
  const d=el.value.length-old;
  try{el.setSelectionRange(pos+d,pos+d)}catch(e){}
  // quick mode: update totals from q_ values
  updSectionTot(cat);
  updProg(cat);
  updBadge(cat);
  updLive();
  checkReady();
}

function setIncomeLevel(){
  const inc=getInc();
  const el=document.getElementById('incomeLevel');
  if(!inc){el.textContent='â€”';return}
  if(inc<15000000) el.textContent='Ø¯Ø±Ø¢Ù…Ø¯ Ù¾Ø§ÛŒÛŒÙ†';
  else if(inc<40000000) el.textContent='Ø¯Ø±Ø¢Ù…Ø¯ Ù…ØªÙˆØ³Ø·';
  else el.textContent='Ø¯Ø±Ø¢Ù…Ø¯ Ø¨Ø§Ù„Ø§';
}

function updSectionTot(cat){
  if(cat==='saving'){return}
  const v=getCatVal(cat);
  const t=document.getElementById('tot-'+cat);
  if(!t) return;
  t.textContent = v>0 ? (ft(v)+' Ù…Ø§Ù‡Ø§Ù†Ù‡') : 'â€” Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡';
  const acc=document.getElementById('acc-'+cat);
  if(acc) acc.classList.toggle('lit',v>0);
}
function updProg(cat){
  const inc=getInc(); if(!inc) return;
  if(cat==='saving'){
    // no progress bar
    return;
  }
  const bm=getBM(inc)[cat]; if(!bm) return;
  const v=getCatVal(cat);
  const p=Math.round((v/inc)*100);
  const fill=document.getElementById('prog-'+cat);
  if(!fill) return;
  let col='var(--green)';
  if(p>bm.warn[1]) col='var(--red)';
  else if(p>bm.warn[0]) col='var(--orange)';
  else if(p>bm.ideal[1]) col='var(--accent)';
  fill.style.background=col;
  fill.style.width = Math.min(p,100)+'%';
}
function updBadge(cat){
  if(cat==='saving') return;
  const inc=getInc(); if(!inc) return;
  const bm=getBM(inc)[cat]; if(!bm) return;
  const v=getCatVal(cat);
  const p=Math.round((v/inc)*100);
  const b=document.getElementById('badge-'+cat);
  if(!b) return;
  if(v<=0){b.style.display='none';return}
  b.style.display='inline-flex';
  b.textContent=p+'Ùª';
  let col='var(--green)',bg='var(--green-l)';
  if(p>bm.warn[1]){col='var(--red)';bg='var(--red-l)'}
  else if(p>bm.warn[0]){col='var(--orange)';bg='var(--orange-l)'}
  else if(p>bm.ideal[1]){col='var(--accent)';bg='var(--accent-ll)'}
  b.style.color=col;
  b.style.background=bg;
}

function updLive(){
  const inc=getInc();
  const vals={};
  CATS.forEach(c=>vals[c]=getCatVal(c));
  const saving=getCatVal('saving');
  const tot=CATS.reduce((s,c)=>s+vals[c],0);
  const rem=inc - tot - saving;

  const rows=[];
  rows.push({l:'Ø¯Ø±Ø¢Ù…Ø¯',v:inc,cls:''});
  rows.push({l:'Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²',v:saving,cls:'green'});
  rows.push({l:'Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§',v:tot,cls:''});
  rows.push({l:'ØªØ±Ø§Ø² Ù…Ø§Ù‡Ø§Ù†Ù‡',v:rem,cls:rem>=0?'green':'red'});

  const box=document.getElementById('liveBox');
  box.innerHTML = rows.map(r=>`
    <div class="live-row">
      <span>${r.l}</span>
      <span class="v ${r.cls}">${ft(r.v)}</span>
    </div>
  `).join('');
}

function checkReady(){
  const inc=getInc();
  document.getElementById('analyzeBtn').disabled = !(inc>0);
  document.getElementById('s1').classList.toggle('done',inc>0);
  document.getElementById('s2').classList.toggle('on',inc>0);
}

// ---------------- Health Score
function calcHealthScore(inc,vals,savVal){
  // Ù†Ù…Ø±Ù‡ Û° ØªØ§ Û±Û°Û° â€” ØªØ±Ú©ÛŒØ¨ ÙˆØ²Ù†â€ŒØ¯Ø§Ø±
  // Û´Û°Ùª Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² | Û³Û°Ùª Ø¨Ø¯Ù‡ÛŒ | Û²Û°Ùª Ø­Ø§Ø´ÛŒÙ‡ Ø§Ù…Ù†ÛŒØª | Û±Û°Ùª ØªÙ…Ø±Ú©Ø²/ØªÙ†ÙˆØ¹ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
  const BM=getBM(inc);
  const totExp=CATS.reduce((s,c)=>s+(vals[c]||0),0);
  const remaining=inc - totExp - savVal;

  const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
  const pct=(v)=>inc>0?(v/inc):0;

  // 1) Saving ratio (0..100)
  const savR=pct(savVal);
  let savScore=0, savLabel='';
  if(savR>=0.20){savScore=100;savLabel='Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ø¹Ø§Ù„ÛŒ (Û²Û°Ùª+)'}
  else if(savR>=0.10){savScore=80;savLabel='Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ø®ÙˆØ¨ (Û±Û°â€“Û²Û°Ùª)'}
  else if(savR>=0.05){savScore=55;savLabel='Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ù…ØªÙˆØ³Ø· (Ûµâ€“Û±Û°Ùª)'}
  else {savScore=25;savLabel='Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ø¶Ø¹ÛŒÙ (<ÛµÙª)'}

  // 2) Debt burden (finance/income) (0..100)
  const debtR=pct(vals.finance||0);
  let debtScore=0, debtLabel='';
  if(debtR===0){debtScore=100;debtLabel='Ø¨Ø¯Ù‡ÛŒ ØµÙØ±'}
  else if(debtR<0.15){debtScore=80;debtLabel='Ø¨Ø¯Ù‡ÛŒ Ù¾Ø§ÛŒÛŒÙ† (<Û±ÛµÙª)'}
  else if(debtR<=0.25){debtScore=55;debtLabel='Ø¨Ø¯Ù‡ÛŒ Ù…ØªÙˆØ³Ø· (Û±Ûµâ€“Û²ÛµÙª)'}
  else {debtScore=25;debtLabel='Ø¨Ø¯Ù‡ÛŒ Ø¨Ø§Ù„Ø§ (>Û²ÛµÙª)'}

  // 3) Safety margin (remaining/income) (0..100)
  const marR=pct(remaining);
  let marScore=0, marLabel='';
  if(marR>=0.10){marScore=100;marLabel='Ø­Ø§Ø´ÛŒÙ‡ Ø§Ù…Ù† Ø¹Ø§Ù„ÛŒ (Û±Û°Ùª+)' }
  else if(marR>0){marScore=55;marLabel='Ø­Ø§Ø´ÛŒÙ‡ Ø§Ù…Ù† Ú©Ù… (Û°â€“Û±Û°Ùª)'}
  else {marScore=15;marLabel='Ú©Ø³Ø±ÛŒ Ø¨ÙˆØ¯Ø¬Ù‡'}

  // 4) Concentration / deviation (0..100)
  // + Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ Û´Û°Ùª Ù†Ø¨Ø§Ø´Ø¯
  // - Ø§Ú¯Ø± Ø¨ÛŒØ´ Ø§Ø² Û² Ø¯Ø³ØªÙ‡ Ø¨Ø§Ù„Ø§ÛŒ warn[1] Ø¨Ø§Ø´Ù†Ø¯
  let over40=false, severe=0;
  CATS.forEach(id=>{
    const p=inc>0?(vals[id]||0)/inc*100:0;
    const bm=BM[id];
    if(p>=40) over40=true;
    if(bm && p>bm.warn[1]) severe++;
  });
  let divScore=60, divLabel='ØªØ±Ú©ÛŒØ¨ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„';
  if(!over40){divScore+=25;divLabel='ØªÙ…Ø±Ú©Ø² Ø®Ø·Ø±Ù†Ø§Ú© Ù†Ø¯Ø§Ø±ÛŒØ¯'}
  if(severe>2){divScore-=35;divLabel='Ú†Ù†Ø¯ Ù†Ø´Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯'}
  divScore=clamp(divScore,0,100);

  const score = Math.round(
    0.40*savScore +
    0.30*debtScore +
    0.20*marScore +
    0.10*divScore
  );

  let level,lc;
  if(score>=85){level='Ø¹Ø§Ù„ÛŒ';lc='var(--green)'}
  else if(score>=70){level='Ø®ÙˆØ¨';lc='var(--green)'}
  else if(score>=50){level='Ù…ØªÙˆØ³Ø·';lc='var(--accent)'}
  else if(score>=30){level='Ø¶Ø¹ÛŒÙ';lc='var(--orange)'}
  else {level='Ø¨Ø­Ø±Ø§Ù†ÛŒ';lc='var(--red)'}

  const factors=[
    {label:savLabel,color:savR>=0.10?'var(--green)':savR>=0.05?'var(--accent)':'var(--red)'},
    {label:debtLabel,color:debtR===0?'var(--green)':debtR<=0.25?'var(--orange)':'var(--red)'},
    {label:marLabel,color:remaining>=0?'var(--green)':'var(--red)'},
    {label:divLabel,color:(severe>2||over40)?'var(--orange)':'var(--green)'}
  ];

  return{score,level,levelColor:lc,factors,details:{savScore,debtScore,marScore,divScore,remaining}}
}

// ---------------- Peer Comparison
function buildPeerComparison(inc,vals){
  // Ø¨Ù†Ú†Ù…Ø§Ø±Ú©â€ŒÙ‡Ø§ÛŒ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù„Ú¯ÙˆÛŒ Ù‡Ø²ÛŒÙ†Ù‡ Ø®Ø§Ù†ÙˆØ§Ø± (Û±Û´Û°Û³â€“Û±Û´Û°Û´) â€” Ù‡Ø¯Ù: Ø¯ÛŒØ¯ Ú©Ù„ÛŒØŒ Ù†Ù‡ Â«Ù‚Ø¶Ø§ÙˆØª Ù‚Ø·Ø¹ÛŒÂ»
  // Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¨Ø§Ø²Ù‡ + Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†
  const BM=getBM(inc);

  const br = (inc<20000000)?'lt20':(inc<=40000000)?'20to40':'gt40';
  const ranges = {
    lt20:{housing:[38,42],food:[27,32],transport:[10,14],lifestyle:[8,12]},
    '20to40':{housing:[30,35],food:[20,25],transport:[10,14],lifestyle:[12,16]},
    gt40:{housing:[22,28],food:[14,18],transport:[10,14],lifestyle:[16,20]}
  }[br];

  const mk = (a)=>({min:a[0],max:a[1],avg:Math.round((a[0]+a[1])/2)});
  const bench = {
    housing: mk(ranges.housing),
    food: mk(ranges.food),
    transport: mk(ranges.transport),
    lifestyle: mk(ranges.lifestyle)
  };

  const peers=[];
  ['housing','food','transport','lifestyle'].forEach(id=>{
    const b=bench[id];
    const pct=inc>0?Math.round((vals[id]||0)/inc*100):0;
    const diff=pct-b.avg;

    let st,sc,sb;
    if(pct>b.max+3){st='Ø¨Ø§Ù„Ø§ØªØ±';sc='var(--red)';sb='var(--red-l)'}
    else if(pct>b.max){st='Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ±';sc='var(--orange)';sb='var(--orange-l)'}
    else if(pct<b.min-3){st='Ú©Ù…ØªØ±';sc='var(--green)';sb='var(--green-l)'}
    else if(pct<b.min){st='Ú©Ù…ÛŒ Ú©Ù…ØªØ±';sc='var(--green)';sb='var(--green-l)'}
    else {st='Ù…Ø´Ø§Ø¨Ù‡';sc='var(--green)';sb='var(--green-l)'}

    const bm=BM[id];
    peers.push({
      emoji: bm.emoji,
      label: bm.label,
      desc: `Ø´Ù…Ø§ ${pct}Ùª â€” Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø¨Ø§ Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø´Ø§Ø¨Ù‡: Ø­Ø¯ÙˆØ¯ ${b.avg}Ùª (Ø¨Ø§Ø²Ù‡ ${b.min}â€“${b.max}Ùª)`,
      status: st,
      statusColor: sc,
      statusBg: sb
    });
  });

  return peers
}

// ---------------- Rules
function generateRules(inc,vals,af){
  // Ù‚ÙˆØ§Ù†ÛŒÙ† Ú©ÙˆÚ†Ú© Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ â€” Ø¨Ø±Ø§ÛŒ Ø¢Ú¯Ø§Ù‡ÛŒ Ùˆ Ú©Ù†ØªØ±Ù„ Â«Ù†Ø´Øªâ€ŒÙ‡Ø§Â»
  const rules=[];
  const add=(t)=>{if(t && !rules.includes(t)) rules.push(t)};

  const delivery=af.delivery||0;
  const cafe=(af.cafe||0);
  const restaurant=(af.restaurant||0);
  const clothing=(af.clothing||0);

  if(delivery>inc*0.03){
    const z=Math.round((delivery/4)*0.65);
    add(`Ø³Ù‚Ù Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†: ${fc(z)} ØªÙˆÙ…Ø§Ù† Ø¯Ø± Ù‡ÙØªÙ‡ (Ø­Ø¯ÙˆØ¯ Û³ÛµÙª Ú©Ù…ØªØ± Ø§Ø² ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ).`);
  }
  if((cafe+restaurant)>inc*0.05){
    add(`Ú©Ø§ÙÙ‡/Ø±Ø³ØªÙˆØ±Ø§Ù†: Ø­Ø¯Ø§Ú©Ø«Ø± Û² Ø¨Ø§Ø± Ø¯Ø± Ù‡ÙØªÙ‡ â€” ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡ (Ø®Ø§Ù†Ù‡/Ù¾ÛŒÚ©â€ŒÙ†ÛŒÚ©/ØºØ°Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡) ØªØ¹Ø±ÛŒÙ Ú©Ù†.`);
  }
  if(clothing>inc*0.03){
    const w=Math.round(clothing*3*0.7);
    add(`Ø®Ø±ÛŒØ¯ Ù„Ø¨Ø§Ø³ ÙÙ‚Ø· ÙØµÙ„ÛŒ â€” Ø³Ù‚Ù Ù‡Ø± ÙØµÙ„: ${fc(w)} ØªÙˆÙ…Ø§Ù†.`);
  }

  const sv=getCatVal('saving');
  if(sv<inc*0.10){
    add(`Ø§ÙˆÙ„ Ù‡Ø± Ù…Ø§Ù‡ Ø­Ø¯Ø§Ù‚Ù„ ${fc(Math.round(inc*0.10))} ØªÙˆÙ…Ø§Ù† (Û±Û°Ùª) Ø±Ø§ Â«Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±Ø¬Â» Ú©Ù†Ø§Ø± Ø¨Ú¯Ø°Ø§Ø±.`);
  }
  if((vals.finance||0)>inc*0.20){
    add(`ØªØ§ Ø³Ø¨Ú© Ø´Ø¯Ù† Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§ØŒ Ø®Ø±ÛŒØ¯ Ø§Ù‚Ø³Ø§Ø·ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…Ù…Ù†ÙˆØ¹ â€” Ù‡Ø± Ù…Ø§Ù‡ Û± Ù‚Ù„Ù… Ø¨Ø¯Ù‡ÛŒ Ø±Ø§ Ù‡Ø¯Ù Ø¨Ú¯ÛŒØ±.`);
  }

  // Ù‚Ø§Ù†ÙˆÙ† Ø¹Ù…ÙˆÙ…ÛŒ Ø«Ø§Ø¨Øª
  add(`Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø¨Ø§Ù„Ø§ÛŒ ${fc(500000)} ØªÙˆÙ…Ø§Ù†ØŒ Û´Û¸ Ø³Ø§Ø¹Øª ØµØ¨Ø± Ú©Ù† (Ù‚Ø§Ù†ÙˆÙ† Ø¶Ø¯-Ù‡ÛŒØ¬Ø§Ù†ÛŒ).`);

  // Ø§Ú¯Ø± Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø®ÛŒÙ„ÛŒ Ø³Ù†Ú¯ÛŒÙ† Ø¨ÙˆØ¯
  if((vals.lifestyle||0)>inc*0.16){
    add(`Ø¨Ø±Ø§ÛŒ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ ÛŒÚ© Â«Ø¨ÙˆØ¯Ø¬Ù‡ Ù‡ÙØªÚ¯ÛŒÂ» ØªØ¹ÛŒÛŒÙ† Ú©Ù† Ùˆ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ø±Ø§ Ø®Ø±Ø¬ Ú©Ù†.`);
  }

  return rules.slice(0,5)
}

function buildLayer3(cat,income,values,allFields){
  const BM=getBM(income),catTotal=values[cat],catPct=Math.round(catTotal/income*100),bm=BM[cat],over=Math.max(0,catTotal-income*bm.ideal[1]/100),overYr=Math.round(over*12);
  const subs=Object.entries(allFields).filter(([id,])=>FIELD_CAT[id]===cat&&allFields[id]>0).sort((a,b)=>b[1]-a[1]);
  const top1=subs[0],top2=subs[1];

  if(cat==='housing'){const hasR=(allFields.rent||0)>0,hasM=(allFields.mortgage||0)>0,tA=Math.round(income*bm.ideal[1]/100);return{tag:'Ù…Ø³Ú©Ù†',title:`Ù…Ø³Ú©Ù† ${catPct}Ùª Ø¯Ø±Ø¢Ù…Ø¯ â€” Ù‡Ø¯Ù: Ø²ÛŒØ± ${bm.ideal[1]}Ùª`,savings:{label:'ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡',val:overYr},steps:[{title:'ÙˆØ§Ù‚Ø¹ÛŒØª',body:`Ù…Ø³Ú©Ù† Ù…Ø§Ù‡Ø§Ù†Ù‡ <em>${fc(catTotal)}</em> ØªÙˆÙ…Ø§Ù† = <em>${catPct}Ùª</em> Ø¯Ø±Ø¢Ù…Ø¯. Ù‡Ø¯Ù: <em>${fc(tA)}</em> ØªÙˆÙ…Ø§Ù†.`,box:null,time:null},{title:hasM?'Ù‚Ø³Ø· ÙˆØ§Ù…':(hasR?'Ú©Ø§Ù‡Ø´ Ø§Ø¬Ø§Ø±Ù‡':'Ù‡Ø²ÛŒÙ†Ù‡ Ø§ØµÙ„ÛŒ'),body:hasM?`Ù‚Ø³Ø· <em>${fc(allFields.mortgage)}</em>. Ø¨Ø±Ø±Ø³ÛŒ ØªØ³ÙˆÛŒÙ‡ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù… Ø§Ø±Ø²Ø´ Ø¯Ø§Ø±Ø¯.`:(hasR?`Ø§Ø¬Ø§Ø±Ù‡ <em>${fc(allFields.rent)}</em>. Ú¯Ø²ÛŒÙ†Ù‡ Û±ÛµÙª Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ØŸ`:'Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ù‚Ù„Ù… Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.'),box:over>0?`Ù‡Ø± <strong>${fc(Math.round(over))}</strong> ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ = <strong>${fc(overYr)}</strong> Ø³Ø§Ù„Ø§Ù†Ù‡.`:null,time:'Û±â€“Û³ Ù…Ø§Ù‡'},{title:'Ø§Ú¯Ø± Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ù†ÛŒØ³Øª',body:'Ø³Ø§ÛŒØ± Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ â€” <strong>Ø®ÙˆØ±Ø§Ú© Ùˆ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ</strong> â€” Ø±Ø§ Ú©Ù†ØªØ±Ù„ Ú©Ù†ÛŒØ¯.',box:null,time:'Ù‡Ù…ÛŒÙ† Ù‡ÙØªÙ‡'}]}}

  if(cat==='food'){const dl=allFields.delivery||0,rs=allFields.restaurant||0,cf=allFields.cafe||0,out=dl+rs+cf+(allFields.lunch_out||0),op=income>0?Math.round(out/income*100):0;return{tag:'Ø®ÙˆØ±Ø§Ú©',title:`ØºØ°Ø§ÛŒ Ø¨ÛŒØ±ÙˆÙ†: ${fc(out)} ØªÙˆÙ…Ø§Ù† Ù…Ø§Ù‡Ø§Ù†Ù‡`,savings:{label:'Ù†ØµÙ Ú©Ø±Ø¯Ù† Ø¨ÛŒØ±ÙˆÙ†â€ŒØ®ÙˆØ±ÛŒ',val:Math.round(out*0.5*12)},steps:[{title:'ÙˆØ§Ù‚Ø¹ÛŒØª',body:`Ø®ÙˆØ±Ø§Ú© <em>${fc(catTotal)}</em> ØªÙˆÙ…Ø§Ù† = <em>${catPct}Ùª</em> Ø¯Ø±Ø¢Ù…Ø¯. Ø³Ù‡Ù… Ø¨ÛŒØ±ÙˆÙ†â€ŒØ®ÙˆØ±ÛŒ <em>${op}Ùª</em>.`,box:null,time:null},{title:'Ù‚Ø§Ù†ÙˆÙ† Û²Ã— Ø¯Ø± Ù‡ÙØªÙ‡',body:`Ø±Ø³ØªÙˆØ±Ø§Ù†/Ú©Ø§ÙÙ‡/Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø±Ø§ Ø¨Ù‡ Û² Ø¨Ø§Ø± Ø¯Ø± Ù‡ÙØªÙ‡ Ù…Ø­Ø¯ÙˆØ¯ Ú©Ù†ÛŒØ¯.`,box:out>0?`Ø§Ú¯Ø± ÙÙ‚Ø· Û³Û°Ùª Ú©Ù… Ú©Ù†ÛŒØ¯ØŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ <strong>${fc(Math.round(out*0.3))}</strong> Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`:null,time:'Ù‡Ù…ÛŒÙ† Ù‡ÙØªÙ‡'},{title:'Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø§Ø±Ø²Ø§Ù†',body:`Û² Ú¯Ø²ÛŒÙ†Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯: Â«ØºØ°Ø§ÛŒ Ø®Ø§Ù†Ú¯ÛŒ Ø³Ø±ÛŒØ¹Â» + Â«ÛŒÚ© ÙˆØ¹Ø¯Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡Â».`,box:null,time:'Û² Ù‡ÙØªÙ‡'}]}}

  if(cat==='lifestyle'){const sm=allFields.small||0,cl=allFields.clothing||0,en=allFields.entertain||0;return{tag:'Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ',title:`Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ ${catPct}Ùª Ø¯Ø±Ø¢Ù…Ø¯ â€” Ù†Ø±Ù…Ø§Ù„ ${bm.ideal[0]}â€“${bm.ideal[1]}Ùª`,savings:{label:'Ú©Ø§Ù‡Ø´ Û±ÛµÙª',val:Math.round(catTotal*0.15*12)},steps:[{title:'ÙˆØ§Ù‚Ø¹ÛŒØª',body:`Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ <em>${fc(catTotal)}</em> ØªÙˆÙ…Ø§Ù†. Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† Ù‚Ù„Ù…: <em>${FIELD_LABEL[top1?.[0]]||''}</em>.`,box:null,time:null},{title:'Ø¨ÙˆØ¯Ø¬Ù‡ Ù‡ÙØªÚ¯ÛŒ',body:`ÛŒÚ© Ø³Ù‚Ù Ù‡ÙØªÚ¯ÛŒ ØªØ¹ÛŒÛŒÙ† Ú©Ù†ÛŒØ¯ Ùˆ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ø±Ø§ Ø®Ø±Ø¬ Ú©Ù†ÛŒØ¯.`,box:`Ø§Ú¯Ø± Û±ÛµÙª Ú©Ù… Ú©Ù†ÛŒØ¯ØŒ Ø³Ø§Ù„Ø§Ù†Ù‡ <strong>${fc(Math.round(catTotal*0.15*12))}</strong> Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯.`,time:'Û± Ù…Ø§Ù‡'},{title:'Ù‚Ø§Ù†ÙˆÙ† Û´Û¸ Ø³Ø§Ø¹Øª',body:`Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ØŒ Û´Û¸ Ø³Ø§Ø¹Øª ØµØ¨Ø± Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ±ÛŒØ¯.`,box:null,time:'Ù‡Ù…ÛŒÙ† Ø§Ù…Ø±ÙˆØ²'}]}}

  if(cat==='finance'){return{tag:'Ø¨Ø¯Ù‡ÛŒ',title:`Ø¨Ø¯Ù‡ÛŒâ€ŒÙ‡Ø§ ${catPct}Ùª Ø¯Ø±Ø¢Ù…Ø¯ â€” Ù‡Ø¯Ù: Ø²ÛŒØ± ${bm.ideal[1]}Ùª`,savings:{label:'ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ ØºÛŒØ±Ù…Ø³ØªÙ‚ÛŒÙ…',val:0},steps:[{title:'ÙˆØ§Ù‚Ø¹ÛŒØª',body:`Ø§Ù‚Ø³Ø§Ø·/Ø¨Ø¯Ù‡ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ <em>${fc(catTotal)}</em> ØªÙˆÙ…Ø§Ù†.`,box:null,time:null},{title:'Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø³Ø§Ø¯Ù‡',body:`ÙØ¹Ù„Ø§Ù‹ Ø¨Ø¯Ù‡ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ù†Ú©Ù†ÛŒØ¯. ÛŒÚ© Ø¨Ø¯Ù‡ÛŒ Ø±Ø§ Ù‡Ø¯Ù Ø¨Ú¯ÛŒØ±ÛŒØ¯ ØªØ§ Ø³Ø¨Ú© Ø´ÙˆØ¯.`,box:null,time:'Û±â€“Û³ Ù…Ø§Ù‡'},{title:'Ø§Ú¯Ø± ÙØ´Ø§Ø± Ø²ÛŒØ§Ø¯ Ø§Ø³Øª',body:`Ø¯Ø± Ú©Ù†Ø§Ø± Ù…Ø°Ø§Ú©Ø±Ù‡/ØªØ¬Ø¯ÛŒØ¯ØŒ Ø±ÙˆÛŒ Ú©Ø§Ù‡Ø´ Ø®ÙˆØ±Ø§Ú© Ùˆ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯.`,box:null,time:'Ù‡Ù…ÛŒÙ† Ù‡ÙØªÙ‡'}]}}

  // default
  return{tag:'Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§',title:`Ú©Ù†ØªØ±Ù„ Ù†Ø´Øª Ø¯Ø± ${bm.label}`,savings:{label:'',val:0},steps:[{title:'ÙˆØ§Ù‚Ø¹ÛŒØª',body:`${bm.label} Ø´Ù…Ø§ ${catPct}Ùª Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø³Øª.`,box:null,time:null},{title:'ÛŒÚ© ØªØºÛŒÛŒØ± Ú©ÙˆÚ†Ú©',body:`ÙÙ‚Ø· Û±Û°Ùª Ú©Ø§Ù‡Ø´ Ú©Ø§ÙÛŒØ³Øª ØªØ§ Ø§Ø«Ø±Ø´ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.`,box:null,time:'Ø§ÛŒÙ† Ù‡ÙØªÙ‡'},{title:'ØªÚ©Ø±Ø§Ø±',body:`Û´ Ù‡ÙØªÙ‡ Ù¾ÛŒÙˆØ³ØªÙ‡ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯.`,box:null,time:'Û± Ù…Ø§Ù‡'}]}
}

function doAnalyze(){
  const inc=getInc();
  const BM=getBM(inc);
  const vals={};CATS.forEach(c=>vals[c]=getCatVal(c));
  const savingVal=getCatVal('saving');
  const allFields=getAllFields();

  const totExp=CATS.reduce((s,c)=>s+(vals[c]||0),0);
  const remaining=inc - totExp - savingVal;

  // Annual planning
  const annual=getAnnualData(); // total yearly, monthly reserve suggestion
  const plannedReserve=annual.monthly||0;
  const adjRemaining=remaining - plannedReserve;

  // ---------------- HEALTH SCORE (Ø¨Ø§ Ù„Ø­Ø§Ø¸ Ú©Ù†Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡)
  const hs=calcHealthScore(inc,vals,savingVal+plannedReserve);
  const circ=2*Math.PI*68;
  const target=circ-(circ*hs.score/100);
  document.getElementById('r-health').innerHTML=
    `<div class="hs-title">Ù†Ù…Ø±Ù‡ Ø³Ù„Ø§Ù…Øª Ù…Ø§Ù„ÛŒ</div>
     <div class="hs-circle-wrap">
       <svg viewBox="0 0 160 160">
         <circle class="hs-circle-bg" cx="80" cy="80" r="68"/>
         <circle class="hs-circle-fill" cx="80" cy="80" r="68"
           style="stroke:${hs.levelColor};stroke-dasharray:${circ};stroke-dashoffset:${circ}" id="hs-fill"/>
       </svg>
       <div class="hs-num">
         <div class="hs-num-val" style="color:${hs.levelColor}" id="hs-val">0</div>
         <div class="hs-num-label">${hs.level}</div>
       </div>
     </div>
     <div class="hs-desc">
       ${hs.score>=70?'ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ Ø®ÙˆØ¨ Ø§Ø³Øª.':hs.score>=50?'Ù‚Ø§Ø¨Ù„ Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ø³Øª.':'Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ Ø¬Ø¯ÛŒ Ø¯Ø§Ø±Ø¯.'}
       ${plannedReserve>0?`<br><span style="color:var(--muted)">* Ù†Ù…Ø±Ù‡ Ø¨Ø§ Ù„Ø­Ø§Ø¸Ù Ú©Ù†Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡.</span>`:''}
     </div>
     <div class="hs-factors">${hs.factors.map(f=>`<div class="hs-factor"><div class="hs-factor-dot" style="background:${f.color}"></div>${f.label}</div>`).join('')}</div>`;
  setTimeout(()=>{
    const fill=document.getElementById('hs-fill');
    if(fill) fill.style.strokeDashoffset=target;
    let cur=0;
    const iv=setInterval(()=>{
      cur+=Math.ceil(hs.score/40);
      if(cur>=hs.score){cur=hs.score;clearInterval(iv)}
      const v=document.getElementById('hs-val');
      if(v) v.textContent=cur;
    },30);
  },300);

  // ---------------- Achievement (month over month)
  renderAchievement(inc,vals,savingVal);

  // ---------------- MIRROR
  let mirrorHtml='';
  if(remaining<0){
    mirrorHtml=`Ø¯Ø±Ø¢Ù…Ø¯ <strong>${ft(inc)}</strong>. Ù‡Ø²ÛŒÙ†Ù‡+Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² <strong>${ft(totExp+savingVal)}</strong> â€” <strong style="color:var(--red)">${ft(Math.abs(remaining))} Ú©Ø³Ø±ÛŒ</strong>.`;
  }else{
    const remPct=inc>0?Math.round((remaining/inc)*100):0;
    if(remPct<10) mirrorHtml=`Ø¯Ø±Ø¢Ù…Ø¯ <strong>${ft(inc)}</strong>. ÙÙ‚Ø· <strong style="color:var(--accent)">${remPct}Ùª (${ft(remaining)})</strong> Ø¨Ø¯ÙˆÙ† ØªØ®ØµÛŒØµ.`;
    else mirrorHtml=`Ø¯Ø±Ø¢Ù…Ø¯ <strong>${ft(inc)}</strong>. Ù¾Ø³ Ø§Ø² Ù‡Ù…Ù‡ØŒ <strong style="color:var(--green)">${ft(remaining)} (${remPct}Ùª)</strong> Ø¨Ø§Ù‚ÛŒ.`;
  }
  if(plannedReserve>0){
    mirrorHtml+=`<br><span style="color:var(--muted)">Ø§Ú¯Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ <strong>${ft(plannedReserve)}</strong> Ú©Ù†Ø§Ø± Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ØŒ ØªØ±Ø§Ø² Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ <strong style="color:${adjRemaining>=0?'var(--green)':'var(--red)'}">${ft(Math.abs(adjRemaining))} ${adjRemaining>=0?'Ù…Ø§Ø²Ø§Ø¯':'Ú©Ø³Ø±ÛŒ'}</strong>.</span>`;
  }
  document.getElementById('r-mirror').innerHTML=mirrorHtml;

  // ---------------- BARS
  const allBars=['saving',...CATS];
  document.getElementById('r-bars').innerHTML=allBars.map(id=>{
    const v=id==='saving'?savingVal:vals[id];
    const p=inc>0?Math.round(v/inc*100):0;
    const bm=BM[id];if(!bm) return '';
    let col='var(--green)',tagCls='t-ok',tagTxt='Ù†Ø±Ù…Ø§Ù„';
    if(id==='saving'){
      if(p<bm.warn[1]){col='var(--red)';tagCls='t-max';tagTxt='Ø®ÛŒÙ„ÛŒ Ú©Ù…'}
      else if(p<bm.ideal[0]){col='var(--orange)';tagCls='t-hi';tagTxt='Ú©Ù…'}
      else if(p>=bm.ideal[1]){col='var(--green)';tagCls='t-ok';tagTxt='Ø¹Ø§Ù„ÛŒ'}
      else {col='var(--accent)';tagCls='t-mild';tagTxt='Ù‚Ø§Ø¨Ù„ Ø¨Ù‡Ø¨ÙˆØ¯'}
    }else{
      if(p>bm.warn[1]){col='var(--red)';tagCls='t-max';tagTxt='Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§'}
      else if(p>bm.warn[0]){col='var(--orange)';tagCls='t-hi';tagTxt='Ø¨Ø§Ù„Ø§'}
      else if(p>bm.ideal[1]){col='var(--accent)';tagCls='t-mild';tagTxt='Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§'}
      else if(p===0){col='var(--muted)';tagCls='t-zero';tagTxt='Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}
    }
    const idealEnd=Math.min(bm.ideal[1],80);
    return`<div class="cbar">
      <div class="cbar-head">
        <div class="cbar-left">
          <span class="cbar-name">${bm.emoji} ${bm.label}</span>
          ${v>0?`<span class="cbar-amt">${ft(v)}</span>`:''}
        </div>
        <div class="cbar-right"><span class="ctag ${tagCls}">${tagTxt}</span><span class="cbar-pct" style="color:${col}">${p}Ùª</span></div>
      </div>
      <div class="cbar-track">
        <div class="cbar-ideal-zone" style="left:0;width:${idealEnd}%"></div>
        <div class="cbar-ideal-end" style="left:${idealEnd}%"></div>
        <div class="cbar-fill" style="background:${col}" data-w="${Math.min(p,100)}"></div>
      </div>
    </div>`;
  }).join('');

  // ---------------- SUMMARY (Ø¨Ø§ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡)
  const showBal=(x)=>`<span class="sr-val ${x>=0?'green':'red'}">${ft(Math.abs(x))}</span>`;
  document.getElementById('r-summ').innerHTML=
    `<div class="sr"><span class="sr-lbl">Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</span><span class="sr-val">${ft(inc)}</span></div>
     <div class="sr"><span class="sr-lbl">Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²</span><span class="sr-val" style="color:var(--green)">${ft(savingVal)}</span></div>
     <div class="sr"><span class="sr-lbl">Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</span><span class="sr-val">${ft(totExp)}</span></div>
     ${annual.total>0?`<div class="sr"><span class="sr-lbl">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡</span><span class="sr-val" style="color:var(--accent)">${ft(plannedReserve)}</span></div>`:''}
     <div class="sr sr-total"><span class="sr-lbl">${(adjRemaining>=0?'Ù…Ø§Ø²Ø§Ø¯':'Ú©Ø³Ø±ÛŒ')} (Ø¨Ø§ Ù„Ø­Ø§Ø¸ Ø³Ø§Ù„Ø§Ù†Ù‡)</span>${showBal(adjRemaining)}</div>`;

  // ---------------- Annual peak warning
  const annualNote = buildAnnualNote(annual,inc);
  if(annualNote){
    document.getElementById('r-summ').innerHTML += annualNote;
  }

  // ---------------- PEER COMPARISON
  const peers=buildPeerComparison(inc,vals);
  document.getElementById('r-peer').innerHTML=
    `<div class="peer-title">ğŸ‘¥ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ø§ÙØ±Ø§Ø¯ Ù…Ø´Ø§Ø¨Ù‡</div>`+
    peers.map(p=>`<div class="peer-row"><div class="peer-emoji">${p.emoji}</div><div class="peer-info"><div class="peer-label">${p.label}</div><div class="peer-desc">${p.desc}</div></div><span class="peer-status" style="color:${p.statusColor};background:${p.statusBg}">${p.status}</span></div>`).join('');

  // ---------------- MULTI-LEAK DETECTION (top 2)
  const scored=CATS
    .map(id=>{
      const p=inc>0?(vals[id]||0)/inc*100:0;
      return{id,score:p-BM[id].ideal[1],p,val:(vals[id]||0)}
    })
    .filter(x=>x.val>0)
    .sort((a,b)=>b.score-a.score);

  const worst=scored[0];
  const second=(scored.length>1 && scored[1].score>0)?scored[1]:null;

  let leaksHtml='';
  if(currentMode==='quick'){
    leaksHtml+=`<div class="r-card" style="padding:18px 20px;margin-bottom:10px">
      <div style="font-size:12px;color:var(--muted);line-height:1.9">
        âš¡ Ø´Ù…Ø§ Ø¯Ø± <strong>Ø­Ø§Ù„Øª Ø³Ø±ÛŒØ¹</strong> Ù‡Ø³ØªÛŒØ¯. 
        <span style="color:var(--text)">Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒÙ…ØŸ</span>
        Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¹Ø¯Ø¯ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø±Ù† Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù† Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†.
      </div>
    </div>`;
  }

  if(worst){
    const lb=BM[worst.id];
    const lp=Math.round(worst.p);
    const over=Math.max(0,worst.val - inc*lb.ideal[1]/100);
    const subItems=Object.entries(allFields)
      .filter(([id,v])=>FIELD_CAT[id]===worst.id && v>0)
      .sort((a,b)=>b[1]-a[1])
      .slice(0,4);

    leaksHtml+=`<div class="leak-card"><div class="leak-inner">
      <div class="leak-cat">ğŸ”´ Ù†Ø´Øª Ø§ØµÙ„ÛŒ</div>
      <div class="leak-name">${lb.emoji} ${lb.label}</div>
      <div class="leak-sub">${lp>lb.ideal[1]?`${lp}Ùª Ø¯Ø±Ø¢Ù…Ø¯ â€” Ù†Ø±Ù…Ø§Ù„ ${lb.ideal[0]}â€“${lb.ideal[1]}Ùª.`+(over>0?` Ù…Ø§Ù‡Ø§Ù†Ù‡ ${ft(over)} Ø§Ø¶Ø§ÙÙ‡.`:''):'Ø§Ù„Ú¯ÙˆÛŒ Ù†Ø³Ø¨ØªØ§Ù‹ Ù…ØªÙˆØ§Ø²Ù†.'}</div>
      <div class="leak-stats">
        <div class="ls"><div class="ls-l">Ø³Ù‡Ù… Ø§Ø² Ø¯Ø±Ø¢Ù…Ø¯</div><div class="ls-v" style="color:var(--red)">${lp}Ùª</div></div>
        <div class="ls"><div class="ls-l">Ø¨Ø§Ø²Ù‡ Ù†Ø±Ù…Ø§Ù„</div><div class="ls-v" style="color:var(--green)">${lb.ideal[0]}â€“${lb.ideal[1]}Ùª</div></div>
        <div class="ls"><div class="ls-l">Ù…Ø¨Ù„Øº Ù…Ø§Ù‡Ø§Ù†Ù‡</div><div class="ls-v">${ft(worst.val)}</div></div>
        ${over>0?`<div class="ls"><div class="ls-l">Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø¶Ø§ÙÙ‡</div><div class="ls-v" style="color:var(--orange)">${ft(over)}</div></div>`:''}
      </div>
      ${subItems.length>1?`<div class="top-items"><div class="top-items-ttl">Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† Ù‚Ù„Ù…â€ŒÙ‡Ø§</div>
        ${subItems.map(([id,v])=>{
          const pct=worst.val>0?Math.round(v/worst.val*100):0;
          return`<div class="top-item"><span class="top-item-name">â— ${FIELD_LABEL[id]||id}</span><div style="display:flex;align-items:center;gap:8px"><span class="top-item-val">${ft(v)}</span><span class="top-item-pct">${pct}Ùª</span></div></div>`;
        }).join('')}
      </div>`:''}
    </div></div>`;
  }

  if(second){
    const lb2=BM[second.id],lp2=Math.round(second.p);
    leaksHtml+=`<div class="leak-card secondary"><div class="leak-inner">
      <div class="leak-cat">ğŸŸ  Ù†Ø´Øª Ø¯ÙˆÙ…</div>
      <div class="leak-name">${lb2.emoji} ${lb2.label}</div>
      <div class="leak-sub">${lp2}Ùª Ø¯Ø±Ø¢Ù…Ø¯ â€” Ù†Ø±Ù…Ø§Ù„ ${lb2.ideal[0]}â€“${lb2.ideal[1]}Ùª.</div>
      <div class="leak-stats">
        <div class="ls"><div class="ls-l">Ø³Ù‡Ù…</div><div class="ls-v" style="color:var(--orange)">${lp2}Ùª</div></div>
        <div class="ls"><div class="ls-l">Ù†Ø±Ù…Ø§Ù„</div><div class="ls-v" style="color:var(--green)">${lb2.ideal[0]}â€“${lb2.ideal[1]}Ùª</div></div>
        <div class="ls"><div class="ls-l">Ù…Ø§Ù‡Ø§Ù†Ù‡</div><div class="ls-v">${ft(second.val)}</div></div>
      </div>
    </div></div>`;
  }
  document.getElementById('r-leaks').innerHTML=leaksHtml;

  // ---------------- LAYER 3: ACTION
  const worstKey=worst?worst.id:CATS[0];
  const l3=buildLayer3(worstKey,inc,vals,allFields);
  document.getElementById('r-act-tag').textContent='Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¹Ù…Ù„ÛŒ â€” '+l3.tag;
  document.getElementById('r-act-title').textContent=l3.title;
  document.getElementById('r-act-savings').innerHTML=l3.savings.val>0?
    `<div class="as-l">${l3.savings.label}</div><div class="as-v">${ft(l3.savings.val)}</div><div class="as-s">Ø¯Ø± Û±Û² Ù…Ø§Ù‡</div>`:'';
  document.getElementById('r-act-steps').innerHTML=l3.steps.map((s,i)=>`
    <div class="a-step">
      <div class="a-step-line"></div>
      <div class="a-step-left"><div class="a-num">${i+1}</div></div>
      <div class="a-content">
        <div class="a-ttl">${s.title}</div>
        <div class="a-body">${s.body}</div>
        ${s.box?`<div class="a-box">${s.box}</div>`:''}
        ${s.time?`<div class="a-time"><div class="a-time-dot"></div>${s.time}</div>`:''}
      </div>
    </div>`).join('');

  // ---------------- PERSONAL RULES (Ú©Ø§Ø±Øª + Ú©Ù¾ÛŒ)
  const rules=generateRules(inc,vals,allFields);
  window._rules=rules.slice();
  document.getElementById('r-rules').innerHTML=
    `<div class="rules-title">ğŸ“Œ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ø®ØµÛŒ Ø´Ù…Ø§</div>`+
    rules.map((r,i)=>`
      <div class="rule-item">
        <div class="rule-num">${i+1}</div>
        <div class="rule-main">${escapeHtml(r)}</div>
        <button class="rule-copy" onclick="copyRule(${i}, this);event.stopPropagation()">Ú©Ù¾ÛŒ</button>
      </div>`).join('');

  // ---------------- WHAT-IF SIMULATOR (top 4)
  window._whatifData={inc,vals,savingVal,plannedReserve,totExp};
  const topCats=scored.slice(0,4).filter(x=>x.val>0);

  document.getElementById('r-whatif').innerHTML=
    `<div class="whatif-title">ğŸ”® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Â«Ø§Ú¯Ø±...Â»</div>`+
    topCats.map(c=>{
      const bm=BM[c.id];
      return `<div class="whatif-row">
        <div class="whatif-label">${bm.emoji} ${bm.label}</div>
        <div class="whatif-slider-wrap">
          <input type="range" class="whatif-slider" min="0" max="50" value="0" oninput="updWhatIf()" data-cat="${c.id}" data-base="${c.val}">
          <span class="whatif-val" id="wv-${c.id}">Û°Ùª Ú©Ø§Ù‡Ø´</span>
        </div>
      </div>`;
    }).join('')+
    `<div class="whatif-result" id="whatif-result">
      <div class="whatif-result-item"><div class="whatif-result-label">ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</div><div class="whatif-result-val" id="wf-mo">â€”</div></div>
      <div class="whatif-result-item"><div class="whatif-result-label">ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡</div><div class="whatif-result-val" id="wf-yr">â€”</div></div>
      <div class="whatif-result-item"><div class="whatif-result-label">Ù†Ù…Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</div><div class="whatif-result-val" id="wf-sc">â€”</div></div>
      <div class="whatif-result-item"><div class="whatif-result-label">Ù¾ÛŒØ§Ù…</div><div class="whatif-result-val" id="wf-msg" style="font-size:12px;font-weight:700">â€”</div></div>
    </div>`;

  // ---------------- Persist snapshot (for returning users)
  saveSnapshot(inc,vals,savingVal);

  // ---------------- SHOW RESULT
  document.getElementById('form').style.display='none';
  document.getElementById('result').style.display='block';
  document.getElementById('s2').classList.add('done');document.getElementById('s2').classList.remove('on');
  document.getElementById('s3').classList.add('on');
  setTimeout(()=>{document.querySelectorAll('.cbar-fill').forEach(el=>el.style.width=el.dataset.w+'%')},150);

  // Build printable block
  buildPrintableSummary();

  window.scrollTo({top:0,behavior:'smooth'});
}

function updWhatIf(){
  const d=window._whatifData;if(!d)return;
  let totalSaved=0;
  const newVals={...d.vals};

  document.querySelectorAll('.whatif-slider').forEach(sl=>{
    const cat=sl.dataset.cat;
    const base=parseInt(sl.dataset.base)||0;
    const pct=parseInt(sl.value)||0;
    const saved=Math.round(base*pct/100);
    totalSaved+=saved;
    newVals[cat]=base-saved;

    const wv=document.getElementById('wv-'+cat);
    if(wv) wv.textContent = pct>0 ? `${pct}Ùª Ú©Ø§Ù‡Ø´ = ${fc(saved)}` : 'Û°Ùª Ú©Ø§Ù‡Ø´';
  });

  const mo=document.getElementById('wf-mo');
  const yr=document.getElementById('wf-yr');
  const sc=document.getElementById('wf-sc');
  const msg=document.getElementById('wf-msg');

  if(mo) mo.textContent = totalSaved>0?ft(totalSaved):'â€”';
  if(yr) yr.textContent = totalSaved>0?ft(totalSaved*12):'â€”';

  if(totalSaved>0){
    const ns=calcHealthScore(d.inc,newVals,d.savingVal + d.plannedReserve + totalSaved);
    if(sc){sc.textContent=ns.score;sc.style.color=ns.levelColor}
    if(msg){
      msg.style.color='var(--green)';
      msg.textContent=`Ø¨Ø§ Ø§ÛŒÙ† ØªØºÛŒÛŒØ±ØŒ Ø­Ø¯ÙˆØ¯ ${ft(totalSaved*12)} Ø¯Ø± Ø³Ø§Ù„ Ø¨ÛŒØ´ØªØ± Ù…ÛŒâ€ŒÙ…ÙˆÙ†Ù‡`;
    }
  }else{
    if(sc){sc.textContent='â€”';sc.style.color='var(--blue)'}
    if(msg){msg.textContent='â€”';msg.style.color='var(--blue)'}
  }
}

function escapeHtml(str){
  return (str||'').replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
}

function copyRule(i,btn){
  const r=(window._rules||[])[i];
  if(!r) return;
  navigator.clipboard.writeText(r).then(()=>{
    if(btn){
      btn.classList.add('rule-copied');
      btn.textContent='Ú©Ù¾ÛŒ Ø´Ø¯';
      setTimeout(()=>{btn.classList.remove('rule-copied');btn.textContent='Ú©Ù¾ÛŒ'},1200);
    }
  });
}

function copyShareText(){
  // Ø®Ù„Ø§ØµÙ‡ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù†â€ŒÙ‡Ø§
  const hs=document.getElementById('hs-val')?.textContent||'â€”';
  const level=document.querySelector('.hs-num-label')?.textContent||'';
  const mirror=document.getElementById('r-mirror')?.innerText||'';
  const leaks=[...document.querySelectorAll('#r-leaks .leak-name')].slice(0,2).map(x=>x.innerText.trim());
  const rules=(window._rules||[]).slice(0,3);

  const txt=[
    'ğŸ“Œ Ø®Ù„Ø§ØµÙ‡ Ù†Ø´Øªâ€ŒÛŒØ§Ø¨ Ù…Ø§Ù„ÛŒ (ØªØ®Ù…ÛŒÙ†ÛŒ)',
    `ğŸ§­ Ù†Ù…Ø±Ù‡ Ø³Ù„Ø§Ù…Øª: ${hs}/100 (${level})`,
    `ğŸª Ø¢ÛŒÙ†Ù‡: ${mirror.replace(/\s+/g,' ').trim()}`,
    leaks.length?`ğŸš¨ Ù†Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ: ${leaks.join(' ØŒ ')}`:'',
    rules.length?'âœ… Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:':'',
    ...rules.map(r=>'â€¢ '+r),
    'â€”',
    'ØªØ®Ù…ÛŒÙ†Ùˆ: Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ ØªØµÙ…ÛŒÙ… Ù…Ø§Ù„ÛŒ (Ù†Ù‡ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚Ø·Ø¹ÛŒ)'
  ].filter(Boolean).join('\n');

  navigator.clipboard.writeText(txt).then(()=>alert('Ù…ØªÙ† Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…'));
}

function doPrint(){
  window.print();
}

function buildAnnualNote(annual,inc){
  if(!annual || !annual.total) return '';
  // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Û±-Û² Ù…Ø§Ù‡ Ù¾ÛŒÚ©
  const entries=Object.entries(annual.peaks||{}).sort((a,b)=>b[1]-a[1]);
  if(!entries.length) return '';
  const top=entries.slice(0,2);
  const peakAmt=top.reduce((s,[,v])=>s+v,0);
  const peakPct=inc>0?Math.round((peakAmt/12)/inc*100):0;
  const months=top.map(([m,])=>m).join(' Ùˆ ');
  return `<div class="sr" style="margin-top:8px">
    <span class="sr-lbl">Ù‡Ø´Ø¯Ø§Ø± Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©</span>
    <span class="sr-val" style="color:var(--orange)">${months}: Ø­Ø¯ÙˆØ¯ ${ft(peakAmt)}</span>
  </div>`;
}

/* ---------- Returning user snapshots ---------- */
const SNAP_KEY='ela_snapshots_v1';
function ym(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')}
function getSnapshots(){
  try{
    const j=localStorage.getItem(SNAP_KEY);
    return j?JSON.parse(j):[];
  }catch(e){return []}
}
function saveSnapshot(inc,vals,savingVal){
  try{
    const now=new Date();
    const key=ym(now);
    const snaps=getSnapshots().filter(s=>s && s.key!==key).slice(-11); // keep last 12
    snaps.push({key,ts:now.toISOString(),inc,vals,savingVal});
    localStorage.setItem(SNAP_KEY,JSON.stringify(snaps));
  }catch(e){}
}
function findPrevSnapshot(){
  const snaps=getSnapshots();
  if(!snaps.length) return null;
  const now=new Date();
  const prev=new Date(now.getFullYear(), now.getMonth()-1, 1);
  const key=ym(prev);
  return snaps.slice().reverse().find(s=>s.key===key) || null;
}
function renderAchievement(inc,vals,savingVal){
  const prev=findPrevSnapshot();
  const box=document.getElementById('r-ach');
  if(!box) return;

  if(!prev){
    box.style.display='none';
    return;
  }

  const foodNow=vals.food||0, foodPrev=prev.vals?.food||0;
  const savNow=savingVal, savPrev=prev.savingVal||0;

  const foodDiffPct = foodPrev>0 ? Math.round(((foodNow-foodPrev)/foodPrev)*100) : null;
  const savDiff = savNow - savPrev;

  let rows='';
  if(foodDiffPct!==null){
    rows += `<div class="ach-row"><span>Ø®ÙˆØ±Ø§Ú© Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ø§Ù‡ Ù‚Ø¨Ù„</span><span class="ach-val" style="color:${foodDiffPct<=-1?'var(--green)':foodDiffPct>=1?'var(--red)':'var(--muted)'}">${foodDiffPct>0?'+':''}${foodDiffPct}Ùª</span></div>`;
  }
  rows += `<div class="ach-row"><span>Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ø§Ù‡ Ù‚Ø¨Ù„</span><span class="ach-val" style="color:${savDiff>=0?'var(--green)':'var(--red)'}">${savDiff>=0?'+':''}${ft(Math.abs(savDiff))}</span></div>`;

  box.innerHTML = `<div class="ach-title">ğŸ Ø¯Ø³ØªØ§ÙˆØ±Ø¯ (Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ù…Ø§Ù‡ Ù‚Ø¨Ù„)</div>` + rows;
  box.style.display='block';
}

/* ---------- Printable summary ---------- */
function buildPrintableSummary(){
  const hs=document.getElementById('hs-val')?.textContent||'â€”';
  const level=document.querySelector('.hs-num-label')?.textContent||'';
  const mirror=document.getElementById('r-mirror')?.innerText||'';
  const leaks=[...document.querySelectorAll('#r-leaks .leak-name')].slice(0,2).map(x=>x.innerText.trim());
  const rules=(window._rules||[]).slice(0,4);

  const annual=getAnnualData();
  const annualLine = annual.total?`â€¢ Ú©Ù†Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡: ${ft(Math.round(annual.total/12))} Ø¯Ø± Ù…Ø§Ù‡`:'';

  const html = `
    <div class="r-card" style="margin:0;border-radius:0">
      <div class="layer-tag"><div class="layer-tag-num">PDF</div><span class="layer-tag-txt">Ø®Ù„Ø§ØµÙ‡ Ù‚Ø§Ø¨Ù„ Ú†Ø§Ù¾</span></div>
      <div style="font-size:18px;font-weight:900;margin-bottom:6px">Ù†Ø´Øªâ€ŒÛŒØ§Ø¨ Ù…Ø§Ù„ÛŒ â€” Ú¯Ø²Ø§Ø±Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ</div>
      <div style="color:var(--muted);font-size:12px;line-height:1.9;margin-bottom:10px">Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø±Ø§ÛŒ Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§Ø³ØªØ› Ù†Ù‡ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚Ø·Ø¹ÛŒ.</div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px">
        <div class="ls" style="min-width:150px"><div class="ls-l">Ù†Ù…Ø±Ù‡ Ø³Ù„Ø§Ù…Øª</div><div class="ls-v">${hs}/100 (${level})</div></div>
        <div class="ls" style="flex:2;min-width:220px"><div class="ls-l">Ø¢ÛŒÙ†Ù‡</div><div class="ls-v" style="font-size:13px;line-height:1.8">${escapeHtml(mirror)}</div></div>
      </div>
      ${leaks.length?`<div style="font-size:12px;margin-bottom:10px"><strong>Ù†Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ:</strong> ${escapeHtml(leaks.join(' ØŒ '))}</div>`:''}
      ${annualLine?`<div style="font-size:12px;margin-bottom:10px">${annualLine}</div>`:''}
      ${rules.length?`<div style="font-size:12px"><strong>Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong><br>${rules.map(r=>'â€¢ '+escapeHtml(r)).join('<br>')}</div>`:''}
    </div>
  `;
  const p=document.getElementById('printable');
  if(p) p.innerHTML = html;
}

function copyReport(){
  const inc=getInc();
  const vals={};CATS.forEach(c=>vals[c]=getCatVal(c));
  const sv=getCatVal('saving');
  const tot=CATS.reduce((s,c)=>s+(vals[c]||0),0);
  const annual=getAnnualData();
  const planned=Math.round((annual.total||0)/12);
  const rem=inc - tot - sv - planned;

  const hs=calcHealthScore(inc,vals,sv+planned);

  const BM=getBM(inc);
  const scored=CATS
    .map(id=>{
      const p=inc>0?(vals[id]||0)/inc*100:0;
      return{id,score:p-BM[id].ideal[1],p,val:(vals[id]||0)}
    })
    .filter(x=>x.val>0)
    .sort((a,b)=>b.score-a.score);

  const leaks=scored.slice(0,2).map(x=>`${BM[x.id].label} (${Math.round(x.p)}Ùª)`).join('ØŒ ')||'â€”';
  const rules=(window._rules||[]).slice(0,5);

  const txt=[
    'Ù†Ø´Øªâ€ŒÛŒØ§Ø¨ Ù…Ø§Ù„ÛŒ â€” Ú¯Ø²Ø§Ø±Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ',
    `Ø¯Ø±Ø¢Ù…Ø¯: ${ft(inc)}`,
    `Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²: ${ft(sv)}`,
    `Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§: ${ft(tot)}`,
    annual.total?`Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ø§Ù‡Ø§Ù†Ù‡): ${ft(planned)}`:'',
    `ØªØ±Ø§Ø² (Ø¨Ø§ Ù„Ø­Ø§Ø¸ Ø³Ø§Ù„Ø§Ù†Ù‡): ${ft(Math.abs(rem))} ${rem>=0?'Ù…Ø§Ø²Ø§Ø¯':'Ú©Ø³Ø±ÛŒ'}`,
    `Ù†Ù…Ø±Ù‡ Ø³Ù„Ø§Ù…Øª Ù…Ø§Ù„ÛŒ: ${hs.score}/100 (${hs.level})`,
    `Ù†Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ: ${leaks}`,
    rules.length?'Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ø®ØµÛŒ:':'',
    ...rules.map(r=>'â€¢ '+r),
    '',
    'Ø§ÛŒÙ† Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ø±Ø§ÛŒ Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§Ø³ØªØ› Ù†Ù‡ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚Ø·Ø¹ÛŒ.'
  ].filter(Boolean).join('\n');

  navigator.clipboard.writeText(txt).then(()=>alert('Ú¯Ø²Ø§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…'));
}

function doReset(){
  document.querySelectorAll('input').forEach(i=>i.value='');
  document.querySelectorAll('.acc').forEach(a=>a.classList.remove('open','lit'));
  setMode('quick');
  document.getElementById('form').style.display='grid';
  document.getElementById('result').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// Init
document.getElementById('form').classList.add('quick-mode');
ANNUAL_ITEMS.forEach(it=>{const sel=document.getElementById(it.mid);if(sel && !sel.value){/* keep blank by default */}});
updAnnualUi();
</script>
</body>
</html>